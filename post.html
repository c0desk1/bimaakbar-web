<!DOCTYPE html>
<html lang="id" data-bs-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="postMetaTitle">Detail Postingan</title>
    <meta name="description" id="postMetaDescription" content="Deskripsi detail postingan.">
    <meta name="keywords" id="postKeywords" content="postingan, detail">
    <link rel="icon" href="assets/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* Variabel CSS Kustom untuk tema Dark Modern */
        :root {
            --bs-body-bg: #1A1A1A; /* Background utama yang lebih gelap */
            --bs-body-color: #E0E0E0; /* Warna teks utama lebih lembut */
            --bs-secondary-color: #B0B0B0; /* Warna teks sekunder/deskripsi */
            --bs-border-color: #333333; /* Warna border yang lebih tegas tapi tetap gelap */
            --bs-emphasis-color: #007AFF; /* Aksen biru yang lebih cerah, cocok untuk glow */
            --bs-light-rgb: 45,45,45; /* Untuk background card/input yang sedikit lebih terang dari body */

            /* Overrides for Bootstrap dark theme internals */
            --bs-body-bg-rgb: 26,26,26;
            --bs-border-color-rgb: 51,51,51;
            --bs-heading-color: #F2F2F7;
            --bs-link-color: var(--bs-emphasis-color);
            --bs-link-hover-color: var(--bs-emphasis-color);
        }

        body {
            padding-top: 56px; /* Untuk header sticky */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        .header-bar {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(8px);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--bs-border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-bar h6 {
            flex-grow: 1;
            text-align: center;
            margin-bottom: 0;
            font-weight: 600;
            color: var(--bs-heading-color);
        }
        .post-thumbnail {
            width: 100%;
            height: 400px; /* Tinggi tetap untuk gambar utama */
            object-fit: cover; /* Memastikan gambar menutupi area tanpa terdistorsi */
            border-radius: var(--bs-border-radius-lg);
            margin-bottom: 2rem;
        }
        .post-content h1, .post-content h2, .post-content h3, 
        .post-content h4, .post-content h5, .post-content h6 {
            color: var(--bs-heading-color);
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }
        .post-content p {
            line-height: 1.8;
            margin-bottom: 1em;
            color: var(--bs-body-color);
        }
        .post-content blockquote {
            border-left: 4px solid var(--bs-emphasis-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--bs-secondary-color);
        }
        .post-content pre {
            background-color: var(--bs-light-rgb); /* Slightly lighter background for code blocks */
            padding: 1rem;
            border-radius: var(--bs-border-radius);
            overflow-x: auto;
            color: #E0E0E0; /* Light text for code */
        }
        .post-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: var(--bs-border-radius-sm);
        }
        .post-content ul, .post-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--bs-body-color);
        }
        .post-content ul li, .post-content ol li {
            margin-bottom: 0.5rem;
        }
        .post-meta {
            font-size: 0.9rem;
            color: var(--bs-secondary-color);
            margin-bottom: 1.5rem;
        }
        .post-meta .badge {
            font-weight: 500;
            background-color: rgba(0, 122, 255, 0.2); /* Light blue background for badges */
            color: var(--bs-emphasis-color);
            padding: 0.4em 0.7em;
            border-radius: 0.3rem;
        }
        h1.post-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bs-heading-color);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            h1.post-title {
                font-size: 2rem;
            }
            .post-thumbnail {
                height: 250px;
            }
            .header-bar {
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <a href="javascript:history.back()" class="btn-back d-flex align-items-center justify-content-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6" style="width: 20px; height: 20px;">
                <path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
            </svg>
        </a>
        <h6 class="text-secondary" id="postHeaderTitle">Detail Postingan</h6>
        <div></div> </div>

    <div class="container py-4">
        <main class="post-detail" id="postDetailContent">
            <h1 class="post-title" id="postTitle">Memuat Postingan...</h1>
            <div class="post-meta mb-4">
                <span id="postCategory" class="badge"></span>
                <span id="postTags"></span>
                <span class="ms-3">Oleh <span id="postAuthor"></span></span>
                <span class="ms-3">Dipublikasikan pada <span id="postPublishedDate"></span></span>
            </div>
            
            <img id="postThumbnail" class="post-thumbnail" src="" alt="Gambar Utama Postingan" style="display: none;">
            
            <div id="postContent" class="post-content">
                <p>Silakan tunggu...</p>
            </div>
        </main>
        <div id="errorContainer" class="text-center py-5" style="display:none;">
            <i class="bi bi-x-circle-fill text-danger" style="font-size: 3rem;"></i>
            <h3 class="mt-3 text-danger">Postingan Tidak Ditemukan</h3>
            <p class="text-secondary">Maaf, postingan yang Anda cari tidak ada atau telah dihapus.</p>
            <a href="dashboard.html" class="btn btn-primary rounded-pill mt-3">Kembali ke Beranda</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://wgcslximcxnprmfqtsoh.supabase.co';
		const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnY3NseGltY3hucHJtZnF0c29oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTE5NzEsImV4cCI6MjA2NTMyNzk3MX0.K0xWAiVdU9vAwJepHV5rMBROBoBDTpXtczXoQopEZQk';

		const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');
            const postSlug = urlParams.get('slug');

            let query = supabase.from('posts').select('id, title, content, slug, thumbnail_url, category, tags, author, created_at, published, meta_title, meta_description, keywords');
            
            if (postId) {
                query = query.eq('id', postId);
            } else if (postSlug) {
                query = query.eq('slug', postSlug);
            } else {
                showError('Parameter ID atau Slug tidak ditemukan di URL.');
                return;
            }

            // Hanya ambil postingan yang sudah dipublikasikan
            query = query.eq('published', true).single();

            const { data: post, error } = await query;

            if (error || !post) {
                console.error('Error fetching post:', error ? error.message : 'Post not found.');
                showError('Postingan tidak ditemukan atau terjadi kesalahan.');
                return;
            }

            // Update Meta Tags
            document.title = post.meta_title || post.title || 'Detail Postingan';
            document.getElementById('postMetaTitle').textContent = post.meta_title || post.title || 'Detail Postingan';
            document.getElementById('postMetaDescription').setAttribute('content', post.meta_description || 'Deskripsi detail postingan.');
            document.getElementById('postKeywords').setAttribute('content', post.keywords || 'postingan, detail');

            document.getElementById('postHeaderTitle').textContent = post.title;
            document.getElementById('postTitle').textContent = post.title;
            
            const postCategory = document.getElementById('postCategory');
            if (post.category) {
                postCategory.textContent = post.category;
                postCategory.style.display = 'inline-block';
            } else {
                postCategory.style.display = 'none';
            }

            const postTags = document.getElementById('postTags');
            if (post.tags) {
                postTags.textContent = post.tags.split(',').map(tag => `#${tag.trim()}`).join(' ');
                postTags.style.display = 'inline';
            } else {
                postTags.style.display = 'none';
            }
            
            document.getElementById('postAuthor').textContent = post.author || 'Anonim';
            document.getElementById('postContent').innerHTML = post.content;

            const publishedDate = new Date(post.created_at).toLocaleDateString('id-ID', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
            document.getElementById('postPublishedDate').textContent = publishedDate;

            const postThumbnail = document.getElementById('postThumbnail');
            if (post.thumbnail_url) {
                postThumbnail.src = post.thumbnail_url;
                postThumbnail.style.display = 'block';
            } else {
                postThumbnail.style.display = 'none';
            }
        });

        function showError(message) {
            document.getElementById('postDetailContent').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.querySelector('#errorContainer p').textContent = message;
            document.title = 'Error | Postingan Tidak Ditemukan';
            document.getElementById('postHeaderTitle').textContent = 'Error';
        }
    </script>
</body>
</html>
