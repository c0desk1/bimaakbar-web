<!DOCTYPE html>
<html lang="id" data-bs-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="previewMetaTitle">Pratinjau Postingan</title>
    <meta name="description" id="previewMetaDescription" content="Pratinjau deskripsi postingan Anda.">
    <meta name="keywords" id="previewKeywords" content="pratinjau, postingan">
    <link rel="icon" href="assets/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        /* Variabel CSS Kustom untuk tema Dark Modern */
        :root {
            --bs-body-bg: #1A1A1A; /* Background utama yang lebih gelap */
            --bs-body-color: #E0E0E0; /* Warna teks utama lebih lembut */
            --bs-secondary-color: #B0B0B0; /* Warna teks sekunder/deskripsi */
            --bs-border-color: #333333; /* Warna border yang lebih tegas tapi tetap gelap */
            --bs-emphasis-color: #007AFF; /* Aksen biru yang lebih cerah, cocok untuk glow */
            --bs-light-rgb: 45,45,45; /* Untuk background card/input yang sedikit lebih terang dari body */

            /* Overrides for Bootstrap dark theme internals */
            --bs-body-bg-rgb: 26,26,26;
            --bs-border-color-rgb: 51,51,51;
            --bs-heading-color: #F2F2F7;
            --bs-link-color: var(--bs-emphasis-color);
            --bs-link-hover-color: var(--bs-emphasis-color);
        }

        body {
            padding-top: 56px; /* Untuk header sticky */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        .header-bar {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(8px);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--bs-border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-bar h6 {
            flex-grow: 1;
            text-align: center;
            margin-bottom: 0;
            font-weight: 600;
            color: var(--bs-heading-color);
        }
        .post-thumbnail {
            width: 100%;
            height: 400px; /* Tinggi tetap untuk gambar utama */
            object-fit: cover; /* Memastikan gambar menutupi area tanpa terdistorsi */
            border-radius: var(--bs-border-radius-lg);
            margin-bottom: 2rem;
        }
        .post-content h1, .post-content h2, .post-content h3, 
        .post-content h4, .post-content h5, .post-content h6 {
            color: var(--bs-heading-color);
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }
        .post-content p {
            line-height: 1.8;
            margin-bottom: 1em;
            color: var(--bs-body-color);
        }
        .post-content blockquote {
            border-left: 4px solid var(--bs-emphasis-color);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--bs-secondary-color);
        }
        .post-content pre {
            background-color: var(--bs-light-rgb); /* Slightly lighter background for code blocks */
            padding: 1rem;
            border-radius: var(--bs-border-radius);
            overflow-x: auto;
            color: #E0E0E0; /* Light text for code */
        }
        .post-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1.5rem auto;
            border-radius: var(--bs-border-radius-sm);
        }
        .post-content ul, .post-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: var(--bs-body-color);
        }
        .post-content ul li, .post-content ol li {
            margin-bottom: 0.5rem;
        }
        .post-meta {
            font-size: 0.9rem;
            color: var(--bs-secondary-color);
            margin-bottom: 1.5rem;
        }
        .post-meta .badge {
            font-weight: 500;
            background-color: rgba(0, 122, 255, 0.2); /* Light blue background for badges */
            color: var(--bs-emphasis-color);
            padding: 0.4em 0.7em;
            border-radius: 0.3rem;
        }
        h1.post-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--bs-heading-color);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            h1.post-title {
                font-size: 2rem;
            }
            .post-thumbnail {
                height: 250px;
            }
            .header-bar {
                padding: 0.75rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <button class="btn btn-outline-secondary btn-sm rounded-pill" onclick="window.close()">
            <i class="bi bi-x-lg me-1"></i> Tutup
        </button>
        <h6 class="text-secondary">Pratinjau Postingan</h6>
        <div></div> </div>

    <div class="container py-4">
        <main class="post-detail">
            <h1 class="post-title" id="postTitle">Memuat Judul...</h1>
            <div class="post-meta mb-4">
                <span id="postCategory" class="badge"></span>
                <span id="postTags"></span>
                <span class="ms-3">Oleh <span id="postAuthor"></span></span>
            </div>
            
            <img id="postThumbnail" class="post-thumbnail" src="" alt="Gambar Utama Postingan" style="display: none;">
            
            <div id="postContent" class="post-content">
                <p>Memuat konten...</p>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Inisialisasi Supabase (gunakan detail yang sama dengan post-add.html jika diperlukan)
        const SUPABASE_URL = 'https://wgcslximcxnprmfqtsoh.supabase.co';
		const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnY3NseGltY3hucHJtZnF0c29oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NTE5NzEsImV4cCI6MjA2NTMyNzk3MX0.K0xWAiVdU9vAwJepHV5rMBROBoBDTpXtczXoQopEZQk';
  
  	const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener('DOMContentLoaded', () => {
            const postDataString = localStorage.getItem('previewPostData');
            if (postDataString) {
                try {
                    const postData = JSON.parse(postDataString);

                    // Update Title dan Meta Tags
                    document.title = postData.meta_title || postData.judul || 'Pratinjau Postingan';
                    document.getElementById('previewMetaTitle').textContent = postData.meta_title || postData.judul || 'Pratinjau Postingan';
                    document.getElementById('previewMetaDescription').setAttribute('content', postData.meta_description || 'Pratinjau deskripsi postingan Anda.');
                    document.getElementById('previewKeywords').setAttribute('content', postData.keywords || 'pratinjau, postingan');

                    document.getElementById('postTitle').textContent = postData.judul || 'Tidak Ada Judul';
                    
                    const postCategory = document.getElementById('postCategory');
                    if (postData.kategori) {
                        postCategory.textContent = postData.kategori;
                        postCategory.style.display = 'inline-block';
                    } else {
                        postCategory.style.display = 'none';
                    }

                    const postTags = document.getElementById('postTags');
                    if (postData.tag) {
                        postTags.textContent = postData.tag.split(',').map(tag => `#${tag.trim()}`).join(' ');
                        postTags.style.display = 'inline';
                    } else {
                        postTags.style.display = 'none';
                    }
                    
                    document.getElementById('postAuthor').textContent = postData.author || 'Anonim';
                    document.getElementById('postContent').innerHTML = postData.konten || '<p>Tidak ada konten untuk pratinjau.</p>';

                    const postThumbnail = document.getElementById('postThumbnail');
                    if (postData.thumbnail_url) {
                        postThumbnail.src = postData.thumbnail_url;
                        postThumbnail.style.display = 'block';
                    } else {
                        postThumbnail.style.display = 'none';
                    }

                } catch (e) {
                    console.error('Error parsing post data from localStorage:', e);
                    document.getElementById('postContent').innerHTML = '<p class="text-danger">Gagal memuat pratinjau. Data tidak valid.</p>';
                    document.getElementById('postTitle').textContent = 'Error Pratinjau';
                }
            } else {
                document.getElementById('postContent').innerHTML = '<p class="text-secondary">Tidak ada data pratinjau yang ditemukan. Harap buat postingan di halaman "Tambah Postingan" terlebih dahulu.</p>';
                document.getElementById('postTitle').textContent = 'Tidak Ada Data Pratinjau';
                document.getElementById('postCategory').style.display = 'none';
                document.getElementById('postTags').style.display = 'none';
                document.getElementById('postAuthor').textContent = 'N/A';
            }
        });
    </script>
</body>
</html>
