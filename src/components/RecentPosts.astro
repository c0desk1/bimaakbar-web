---
// src/components/RecentPosts.astro

import { getCollection, type CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';

type BlogPost = CollectionEntry<'blog'>;

const allPosts = await getCollection('blog');

const sortedPosts = allPosts.sort((a: BlogPost, b: BlogPost) => {
  return b.data.pubDate.getTime() - a.data.pubDate.getTime();
});

const recentPosts: BlogPost[] = sortedPosts.slice(0, 3);
---
<section class="container mx-auto px-4 py-4 md:py-4">
  <div class="flex justify-between items-center mb-12">
    <h2 class="text-3xl font-bold text-white">Tulisan Terbaru</h2>
    <a href="/blog" class="border border-gray-700 hover:bg-gray-800 text-gray-300 font-semibold py-2 px-5 rounded-lg transition-colors text-sm hidden sm:block">
      Semua Postingan &rarr;
    </a>
  </div>
  
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
    {recentPosts.map((post) => (
      <a href={`/blog/${post.slug}/`} class="block border border-gray-800 rounded-lg overflow-hidden hover:border-cyan-400 transition-colors group bg-gray-900/50">
        {post.data.heroImage && (
          <Image 
            src={post.data.heroImage} 
            alt={`Gambar untuk ${post.data.title}`} 
            width={400} 
            height={225}
            format="webp"
            class="w-full h-48 object-cover"
          />
        )}
        <div class="p-6">
          <h3 class="text-xl font-bold mb-2 group-hover:text-cyan-400 transition-colors">{post.data.title}</h3>
          <p class="text-gray-400 text-sm mb-4">
            {new Date(post.data.pubDate).toLocaleDateString('id-ID', {
              year: 'numeric', month: 'long', day: 'numeric'
            })}
          </p>
          <p class="text-gray-300 mb-4">{post.data.description}</p>
          <span class="font-semibold text-cyan-400">Baca Selengkapnya â†’</span>
        </div>
      </a>
    ))}
  </div>
</section>