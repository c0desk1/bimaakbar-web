---
import PostCard from './PostCard.tsx';
import type { Post } from '../types';

const res = await fetch(import.meta.env.CMS_API_URL);

if (!res.ok) {
  throw new Error('Gagal fetch data blog');
}

const allPosts: Post[] = await res.json();
const featured = allPosts
  .filter((post) => {
    const status = String(post.status || '').toUpperCase();
    return post.featured && status !== 'DRAFT';
  })
  .slice(0, 3);

const fallbackPosts = allPosts
  .filter((post) => {
    const status = String(post.status || '').toUpperCase();
    return status !== 'DRAFT';
  })
  .slice(0, 3);

const featuredPosts = featured.length > 0 ? featured : fallbackPosts;
const heading = featured.length > 0 ? 'Featured' : 'Terbaru';
---

{featuredPosts.length > 0 && (
  <section class="w-full py-6">
    <div class="max-w-7xl mx-auto">
      <h2 class="text-2xl font-semibold text-[var(--color-fg)] mb-4">{heading}</h2>
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {featuredPosts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    </div>
  </section>
)}