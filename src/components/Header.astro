---
// src/components/Header.astro
import { SITE, LINKS } from "../consts";
import Container from "./Container.astro";
import ThemeToggleButton from './ThemeToggleButton.tsx';
import MobileMenu from './MobileMenu.tsx';
import { Image } from 'astro:assets';
import logo from '../assets/bimaakbar-logo.png';
import HeaderLink from './HeaderLink.astro';

const con = (...classes: string[]) => classes.filter(Boolean).join(' ');
const currentPath = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');
---

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const header = document.querySelector('header[aria-label="Base Header"]');
        const mobileMenuButton = document.getElementById('mobile-menu-toggle');
        const mobileMenuElement = document.getElementById('mobile-menu');

        let isMenuOpen = false;

        const dispatchMobileMenuToggle = () => {
            if (mobileMenuElement) {
                const event = new CustomEvent('mobileMenuToggle', { detail: { isOpen: isMenuOpen } });
                mobileMenuElement.dispatchEvent(event);
            }
        };

        const toggleMenu = () => {
            isMenuOpen = !isMenuOpen;
            if (mobileMenuButton) {
                mobileMenuButton.setAttribute('aria-expanded', isMenuOpen.toString());
                mobileMenuButton.innerHTML = isMenuOpen ? '<i class="ri-close-line" aria-hidden="true"></i>' : '<i class="ri-menu-3-line" aria-hidden="true"></i>';
            }
            document.body.style.overflow = isMenuOpen ? 'hidden' : 'auto';
            dispatchMobileMenuToggle();
        };

        if (mobileMenuButton) {
            mobileMenuButton.addEventListener('click', toggleMenu);
        }
        const scrollThreshold = 10;
        let isScrolled = false;

        const handleScroll = () => {
            const scrolledCurrently = window.scrollY > scrollThreshold;
            if (scrolledCurrently !== isScrolled) {
                isScrolled = scrolledCurrently;
                if (header) {
                    header.classList.toggle('is-scrolled', isScrolled);
                }
            }
        };

        window.addEventListener('scroll', handleScroll);
        handleScroll();

        if (mobileMenuElement) {
            mobileMenuElement.addEventListener('mobileMenuLinkClick', () => {
                if (isMenuOpen) {
                    toggleMenu();
                }
            });
        }
    });
</script>
<header class={`fixed top-0 z-50 w-full h-auto bg-transparent border-b border-transparent`} aria-label="Base Header">
    <Container size="2xl">
        <div class='flex items-center justify-between py-4 h-16'>
            <div class="flex-1 items-center">
                <a href="/" aria-label={`Beranda ${SITE.TITLE}`} class="flex gap-2 items-center text-[var(--color-fg)] text-xl hover:text-[var(--color-fg)]">
                    <Image src={logo} alt={SITE.TITLE} width={32} height={32} loading="eager" class="w-8 h-8" />
                </a>
                <span class="hidden md:inline font-semibold text-center">{SITE.TITLE}</span>
            </div>
            <nav class="hidden md:flex items-center gap-4" aria-label="Navigasi desktop">
                {LINKS.map((link) => (
                    <HeaderLink
                        href={link.HREF}
                        class="px-3 py-1 rounded-full hover:text-[var(--color-fg)] hover:bg-[var(--color-hover)] text-[var(--color-muted)]"
                        aria-label={`Menu ${link.TEXT}`}>
                        {link.TEXT}
                    </HeaderLink>
                ))}
            </nav>
            <div class="flex-1 flex items-center justify-end gap-4">
                <div class="hidden md:flex gap-4">
                    <ThemeToggleButton client:load aria-label="Toggle tema gelap atau terang" />
                </div>
                <button
                    id="mobile-menu-toggle"
                    class={con("flex md:hidden cursor-pointer", "size-9 rounded-full p-2 text-xl items-center justify-center", "bg-transparent hover:bg-[var(--color-hover)] text-[var(--color-muted)]", "stroke-current hover:stroke-[var(--color-fg)] hover:text-[var(--color-fg)]", "border border-[var(--color-border)]")}
                    aria-label="Buka menu navigasi"
                    aria-expanded="false"
                    aria-controls="mobile-menu"
                >
                    <i class="ri-menu-3-line" aria-hidden="true"></i>
                </button>
            </div>
        </div>
        <MobileMenu
            id="mobile-menu"
            currentPath={currentPath}
            client:load
            className="z-50"
        />
    </Container>
</header>