---
import Layout from '../../layouts/Layout.astro';
import { getAllPosts, getAllTags, getPostsByTag } from '../../utils/getPosts';

const url = new URL(Astro.request.url);
const selectedTag = url.searchParams.get('tag') ?? '';
const tags = await getAllTags();
const posts = selectedTag ? await getPostsByTag(selectedTag) : await getAllPosts();
---

<Layout title="Blog">
  <h1 class="text-4xl font-bold text-[var(--color-fg)]">Blog</h1>
  <p class="mt-4 text-[var(--color-muted)]">Daftar postingan.</p>

  <div class="mt-6 flex flex-wrap gap-2">
    <a href="/blog" class="px-3 py-1 border rounded-full text-sm hover:bg-gray-100 dark:hover:bg-gray-800 transition">Semua</a>
    {tags.map(tag => (
      <a
        href={`/blog?tag=${encodeURIComponent(tag)}`}
        class={`px-3 py-1 border rounded-full text-sm transition ${
          tag === selectedTag
            ? 'bg-[var(--color-accent)] text-white'
            : 'hover:bg-gray-100 dark:hover:bg-gray-800'
        }`}
      >
        {tag}
      </a>
    ))}
  </div>

  <div class="mt-8 space-y-6">
    {posts.length === 0 && <p class="text-sm text-[var(--color-muted)]">Belum ada postingan.</p>}
    {posts.map(post => (
      <article class="border-b pb-4">
        <h2 class="text-xl font-semibold">
          <a href={`/blog/${post.slug}`} class="hover:underline">{post.data.title}</a>
        </h2>
        <p class="text-sm text-[var(--color-muted)] mt-1">{post.data.date.toLocaleDateString()}</p>
      </article>
    ))}
  </div>
</Layout>
