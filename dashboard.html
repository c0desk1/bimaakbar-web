<!DOCTYPE html>

<html lang="id">



<head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Dashboard</title>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>

    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>



    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
    --background-dark: #1C1C1E; /* Tetap sebagai latar belakang utama yang solid dan gelap */
    --card-background-dark: rgba(28, 28, 30, 0.65); /* Sedikit disesuaikan transparansinya untuk efek glassmorphism yang lebih terasa */
    --border-dark: rgba(255, 255, 255, 0.15); /* Border sedikit lebih terlihat */
    --primary-color: #0A84FF;
    --primary-color-hover: #3399FF;
    --accent-color: #007AFF;
    --text-light: #E0E0E0;
    --text-lighter: #FFFFFF;
    --text-muted: #8E8E93;
    --shadow-dark: rgba(0, 0, 0, 0.5); /* Shadow sedikit lebih gelap */
    --glass-blur: 30px;
    --gradient-start: #007AFF;
    --gradient-end: #5AC8FA;

    --sidebar-width: 250px;
    --sidebar-header-height: 56px;
}

/* --- General Styles --- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
    background-color: var(--background-dark);
    color: var(--text-light);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    padding-top: 56px; /* Space for fixed header on mobile */
    padding-bottom: 56px; /* Space for fixed bottom nav on mobile */
    position: relative;
    overflow-x: hidden;
}

/* --- Header (Fixed at top for mobile) --- */
header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem 1rem;
    background-color: var(--card-background-dark); /* Menggunakan card background */
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-bottom: 1px solid var(--border-dark);
    box-shadow: 0 4px 15px var(--shadow-dark);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    width: 100%;
    border-bottom-left-radius: 18px;
    border-bottom-right-radius: 18px;
}

.header-left,
.header-right {
    flex: 1;
    display: flex;
    align-items: center;
    min-width: 0;
}

.header-left {
    justify-content: flex-start;
    font-weight: 500;
    font-size: 0.95rem;
    color: var(--text-lighter);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.header-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    z-index: 1;
}

.header-center img {
    height: 40px;
    width: 40px;
    object-fit: contain;
    opacity: 0.9;
}

.header-right {
    justify-content: flex-end;
}

.logout-btn {
    background-color: transparent;
    color: var(--primary-color);
    padding: 0.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1.6rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    transition: color 0.2s ease, background-color 0.2s ease;
}

.logout-btn:hover {
    color: var(--primary-color-hover);
    background-color: rgba(10, 132, 255, 0.15);
}

.logout-btn ion-icon {
    font-size: 1.6rem;
}

.header-stats {
    display: none; /* Hidden by default, shown on desktop */
    gap: 15px;
    font-size: 0.85em;
    color: var(--text-muted);
    justify-content: flex-end;
    margin-left: 1rem;
}

.header-stats .stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
}

.header-stats .stat-item ion-icon {
    font-size: 1.1em;
    color: var(--primary-color);
}

/* --- Main Content Wrapper --- */
.content-wrapper {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    width: 100%;
}

.main-content {
    flex-grow: 1;
    padding: 1.5rem;
    max-width: 100%;
    margin: 0 auto;
    width: 100%;
}

/* --- Greeting Section --- */
.greeting-section {
    padding: 2rem 0;
    border-bottom: 1px solid var(--border-dark);
    margin-bottom: 1.5rem;
    text-align: center;
}

.greeting-content {
    margin: 0;
}

.greeting-content h1 {
    font-size: clamp(1.8rem, 8vw, 3rem);
    margin-bottom: 0;
    line-height: 1.3;
    text-align: center;
    background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-size: 200% 100%;
    animation: gradient-flow 3s linear infinite alternate;
    font-weight: 700;
}

@keyframes gradient-flow {
    0% {
        background-position: 0% 50%;
    }
    100% {
        background-position: 100% 50%;
    }
}

/* --- Stat Grid --- */
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-dark);
    margin-bottom: 1.5rem;
}

.stat-card {
    background-color: var(--card-background-dark); /* Menggunakan card background */
    padding: 1.2rem;
    border-radius: 14px;
    border: 1px solid var(--border-dark);
    box-shadow: 0 6px 20px var(--shadow-dark);
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100px;
    position: relative;
    overflow: hidden;
    color: var(--text-light);
    backdrop-filter: blur(calc(var(--glass-blur) / 2));
    -webkit-backdrop-filter: blur(calc(var(--glass-blur) / 2));
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
}

.stat-card .stat-value {
    font-size: 2rem;
    font-weight: 600;
    color: var(--text-lighter);
    margin-bottom: 0.4rem;
}

.stat-card .stat-label {
    font-size: 0.9rem;
    color: var(--text-muted);
}

/* --- Info & List Sections --- */
.dashboard-section {
    background-color: var(--card-background-dark); /* Menggunakan card background */
    border-radius: 14px;
    padding: 25px;
    box-shadow: 0 6px 20px var(--shadow-dark);
    border: 1px solid var(--border-dark);
    margin-bottom: 25px;
    overflow: hidden;
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
}

.dashboard-section h2 {
    color: var(--primary-color);
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.4em;
    font-weight: 600;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed var(--border-dark);
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    color: var(--text-muted);
    font-weight: 400;
    font-size: 0.95em;
}

.info-value {
    color: var(--text-lighter);
    font-weight: 500;
    font-size: 1em;
}

.data-list ul {
    list-style: none;
    padding: 0;
}

.data-list ul li {
    background-color: var(--card-background-dark); /* Diubah agar konsisten dengan card background */
    border: 1px solid var(--border-dark);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(calc(var(--glass-blur) / 3)); /* Blur sedikit lebih ringan untuk list item */
    -webkit-backdrop-filter: blur(calc(var(--glass-blur) / 3));
}

.data-list ul li span {
    flex: 1;
    min-width: 150px;
    color: var(--text-light);
}

.data-list ul li .item-title {
    font-weight: 600;
    font-size: 1.05em;
    color: var(--text-lighter);
}

.data-list ul li .item-meta {
    font-size: 0.88em;
    color: var(--text-muted);
    margin-top: 4px;
}

.data-list ul li .actions {
    display: flex;
    gap: 8px;
    margin-left: auto;
}

.data-list ul li .actions button {
    background-color: var(--primary-color);
    color: var(--text-lighter);
    border: none;
    padding: 7px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85em;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: background-color 0.3s ease;
}

.data-list ul li .actions button:hover {
    background-color: var(--primary-color-hover);
}

.data-list ul li .actions button ion-icon {
    font-size: 1em;
    vertical-align: middle;
}

.activity-item {
    padding: 12px 0;
    border-bottom: 1px dashed var(--border-dark);
    display: flex;
    flex-direction: column;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-item .log-time {
    font-size: 0.85em;
    color: var(--text-muted);
    margin-bottom: 5px;
}

.activity-item .log-message {
    font-size: 0.95em;
    color: var(--text-light);
}

/* --- Top Posts List Specific Styles --- */
.top-posts-list .post-details {
    flex-grow: 1;
    min-width: 150px;
}

.top-posts-list .post-title {
    font-weight: 600;
    font-size: 1.05em;
    color: var(--text-lighter);
}

.top-posts-list .post-meta {
    font-size: 0.88em;
    color: var(--text-muted);
    margin-top: 4px;
}

.top-posts-list .post-stats {
    margin-left: auto;
    text-align: right;
    white-space: nowrap;
}

.top-posts-list .stat-value {
    font-size: 1.2em;
    font-weight: 600;
    color: var(--primary-color);
}

.top-posts-list .stat-label {
    font-size: 0.8em;
    color: var(--text-muted);
}

/* --- Utility Classes --- */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

.flex-grow {
    flex-grow: 1;
}

/* --- Styles for initial loading/hiding content --- */
body.loading-dashboard > *:not(#loadingOverlay) {
    display: none;
}

#loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--background-dark);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: var(--text-muted);
    font-size: 1.1rem;
    opacity: 1;
    transition: opacity 0.3s ease-in-out;
}

#loadingOverlay.hidden {
    opacity: 0;
    pointer-events: none;
}

/* Spinner konsisten untuk overlay */
.spinner-flower-base {
    position: relative;
    display: inline-block;
}

.spinner-flower-base div {
    position: absolute;
    border-radius: 2px;
    opacity: 0.25;
    animation: flower-spin 1.2s linear infinite;
}

/* Keyframes for spinner animation */
@keyframes flower-spin {
    0% {
        opacity: 0.25;
    }
    50% {
        opacity: 1;
    }
}

/* Styles for the LARGE overlay spinner */
.spinner-flower-large {
    width: 32px;
    height: 32px;
}

.spinner-flower-large div {
    width: 3.5px;
    height: 8px;
    background: var(--primary-color);
    transform-origin: 16px 16px;
}

/* Positioning for large spinner petals */
.spinner-flower-large div:nth-child(1) { transform: rotate(0deg) translate(12px); animation-delay: -1.1s; }
.spinner-flower-large div:nth-child(2) { transform: rotate(45deg) translate(12px); animation-delay: -1s; }
.spinner-flower-large div:nth-child(3) { transform: rotate(90deg) translate(12px); animation-delay: -0.9s; }
.spinner-flower-large div:nth-child(4) { transform: rotate(135deg) translate(12px); animation-delay: -0.8s; }
.spinner-flower-large div:nth-child(5) { transform: rotate(180deg) translate(12px); animation-delay: -0.7s; }
.spinner-flower-large div:nth-child(6) { transform: rotate(225deg) translate(12px); animation-delay: -0.6s; }
.spinner-flower-large div:nth-child(7) { transform: rotate(270deg) translate(12px); animation-delay: -0.5s; }
.spinner-flower-large div:nth-child(8) { transform: rotate(315deg) translate(12px); animation-delay: -0.4s; }

/* --- Bottom Navigation Bar (MOBILE ONLY) --- */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    background-color: var(--card-background-dark); /* Menggunakan card background */
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-top: 1px solid var(--border-dark);
    box-shadow: 0 -4px 15px var(--shadow-dark);
    z-index: 100;
    display: flex;
    justify-content: space-around;
    padding: 0.5rem 0;
    border-top-left-radius: 18px;
    border-top-right-radius: 18px;
}

.bottom-nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.75rem;
    padding: 0.3rem 0;
    transition: color 0.2s ease, transform 0.2s ease;
}

.bottom-nav-item ion-icon {
    font-size: 1.5rem;
    margin-bottom: 0.2rem;
}

.bottom-nav-item.active,
.bottom-nav-item:hover {
    color: var(--primary-color);
    transform: translateY(-2px);
}

.bottom-nav-item.active {
    font-weight: 600;
}

/* --- Sidebar Navigation (DESKTOP ONLY) --- */
.sidebar {
    display: none; /* Hidden by default, shown on desktop */
    flex-direction: column;
    width: var(--sidebar-width);
    background-color: var(--card-background-dark); /* Menggunakan card background */
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-right: 1px solid var(--border-dark);
    box-shadow: 4px 0 15px var(--shadow-dark);
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    z-index: 90;
    padding-top: var(--sidebar-header-height);
    border-top-right-radius: 18px;
    border-bottom-right-radius: 18px;
    overflow-y: auto;
    padding-bottom: 1rem;
}

.sidebar-header {
    display: flex;
    justify-content: center;
    align-items: center;
    height: var(--sidebar-header-height);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 0 1rem;
    border-bottom: 1px solid var(--border-dark);
    background-color: var(--card-background-dark); /* Menggunakan card background */
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    z-index: 101;
    border-top-right-radius: 18px;
}

.sidebar-header img {
    height: 38px;
    opacity: 0.95;
}

.sidebar-nav-list {
    list-style: none;
    padding: 1rem 0;
}

.sidebar-nav-item {
    display: block;
    margin: 0.5rem 0.8rem;
}

.sidebar-nav-item a {
    display: flex;
    align-items: center;
    padding: 0.8rem 1rem;
    color: var(--text-muted);
    text-decoration: none;
    border-radius: 10px;
    transition: background-color 0.2s ease, color 0.2s ease;
}

.sidebar-nav-item a:hover {
    background-color: rgba(10, 132, 255, 0.15);
    color: var(--primary-color-hover);
}

.sidebar-nav-item a.active {
    background: linear-gradient(45deg, var(--primary-color), var(--gradient-end));
    color: var(--text-lighter);
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.sidebar-nav-item a ion-icon {
    font-size: 1.3rem;
    margin-right: 0.8rem;
    min-width: 24px;
}

.sidebar-nav-item a.logout-link {
    color: #FF453A;
    margin-top: 1.5rem;
}

.sidebar-nav-item a.logout-link:hover {
    background-color: rgba(255, 69, 58, 0.15);
    color: #FF665C;
}

/* --- Form & Table Styles --- */
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-light);
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="password"],
.form-group input[type="number"],
.form-group input[type="date"],
.form-group input[type="time"],
.form-group input[type="datetime-local"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--border-dark);
    background-color: var(--background-dark); /* Input field background tetap gelap solid */
    color: var(--text-light);
    font-size: 1em;
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-group select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23E0E0E0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 24px;
    padding-right: 40px;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.3);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

/* Custom Radio Button & Checkbox Styling */
.form-group .radio-group,
.form-group .checkbox-group {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.form-group .radio-group label,
.form-group .checkbox-group label {
    display: inline-flex;
    align-items: center;
    font-weight: 400;
    margin-bottom: 0;
    cursor: pointer;
    position: relative;
    padding-left: 28px;
    color: var(--text-light);
}

.form-group .radio-group input[type="radio"],
.form-group .checkbox-group input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.form-group .radio-group label::before,
.form-group .checkbox-group label::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    border: 2px solid var(--text-muted);
    background-color: var(--background-dark);
    transition: all 0.2s ease;
}

.form-group .radio-group label::before {
    border-radius: 50%;
}

.form-group .checkbox-group label::before {
    border-radius: 4px;
}

.form-group .radio-group input[type="radio"]:hover + label::before,
.form-group .checkbox-group input[type="checkbox"]:hover + label::before {
    border-color: var(--primary-color);
}

.form-group .radio-group input[type="radio"]:checked + label::before,
.form-group .checkbox-group input[type="checkbox"]:checked + label::before {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.3);
}

.btn-submit {
    background-color: var(--primary-color);
    color: white;
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: background-color 0.2s ease, transform 0.2s ease;
}

.btn-submit:hover {
    background-color: var(--primary-color-hover);
    transform: translateY(-2px);
}

.table-container {
    overflow-x: auto;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 0.9em;
}

.data-table th,
.data-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-dark);
    color: var(--text-light);
}

.data-table th {
    background-color: rgba(0, 0, 0, 0.2);
    color: var(--text-lighter);
    font-weight: 600;
    text-transform: uppercase;
}

.data-table tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.data-table .actions-col button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8em;
    margin-right: 5px;
    white-space: nowrap;
    transition: background-color 0.2s ease;
}

.data-table .actions-col button:hover {
    background-color: var(--primary-color-hover);
}

.data-table .actions-col button.delete-btn {
    background-color: #FF453A;
}

.data-table .actions-col button.delete-btn:hover {
    background-color: #FF665C;
}

/* --- Chart specific styles --- */
.chart-container {
    position: relative;
    width: 100%;
    height: 350px;
    margin-top: 20px;
    padding: 15px;
    background-color: var(--background-dark); /* Chart container background tetap solid */
    border: 1px solid var(--border-dark);
    border-radius: 10px;
    box-shadow: 0 4px 10px var(--shadow-dark);
    margin-bottom: 20px;
}

/* Flex container for date and time inputs */
.datetime-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.datetime-group .form-group {
    flex: 1;
    min-width: 150px;
}

/* --- Post List & Card Styles --- */
.post-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    width: 100%;
    padding: 1rem 0;
}

.post-card {
    background-color: var(--card-background-dark); /* Diubah agar konsisten dengan card background */
    border: 1px solid var(--border-dark);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 8px var(--shadow-dark);
    display: flex;
    flex-direction: column;
    padding: 1.2rem;
    backdrop-filter: blur(calc(var(--glass-blur) / 2)); /* Menambahkan blur untuk glassmorphism */
    -webkit-backdrop-filter: blur(calc(var(--glass-blur) / 2));
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.post-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px var(--shadow-dark);
}

.post-card-title {
    font-size: 1.5em;
    margin-bottom: 10px;
    line-height: 1.3;
    color: var(--text-lighter);
}

.post-card-action {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background-color: var(--primary-color);
    color: var(--text-lighter);
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: 600;
    margin-top: 10px;
    align-self: flex-start;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.post-card-action:hover {
    background-color: var(--primary-color-hover);
    transform: translateY(-2px);
}

.post-card-action button {
    background-color: var(--background-dark); /* Tetap solid untuk tombol di dalam card */
    color: var(--text-light);
    border: 1px solid var(--border-dark);
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9em;
    text-transform: capitalize;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

.post-card-action button:hover {
    background-color: var(--primary-color);
    color: var(--text-lighter);
    border-color: var(--primary-color);
}

.post-card-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    font-size: 0.85em;
    color: var(--text-muted);
    margin-top: auto;
    padding-top: 15px;
    border-top: 1px solid var(--border-dark);
    margin-bottom: 0;
}

.post-card-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
}

.post-card-hashtags {
    font-size: 0.9em;
    color: var(--primary-color);
    margin-top: 10px;
}

.post-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    font-size: 0.85em;
    color: var(--text-muted);
    margin-top: auto;
    margin-bottom: 15px;
}
.post-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
}
.post-actions {
    margin-top: 0.5em;
}

/* --- Modal Styles --- */
.modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}
.modal-content {
    background: var(--card-background-dark); /* Menggunakan card background */
    padding: 20px;
    border-radius: 14px;
    max-width: 600px;
    width: 90%;
    position: relative;
    box-shadow: 0 10px 30px var(--shadow-dark);
    border: 1px solid var(--border-dark);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
}
.close {
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 2em;
    cursor: pointer;
    color: var(--text-muted);
    transition: color 0.2s ease;
}
.close:hover {
    color: var(--text-lighter);
}

/* --- Media Queries --- */
@media (min-width: 768px) {
    body {
        padding-top: 0;
        padding-bottom: 0;
        flex-direction: row;
    }

    header {
        display: none;
    }

    .bottom-nav {
        display: none;
    }

    .sidebar {
        display: flex;
    }

    .content-wrapper {
        margin-left: var(--sidebar-width);
        flex-direction: column;
        width: calc(100% - var(--sidebar-width));
    }

    .main-content {
        max-width: 1000px;
        padding: 2rem;
    }

    .header-stats {
        display: flex;
    }

    .post-list {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
}

@media (min-width: 1024px) {
    .main-content {
        padding: 2.5rem;
    }
}
    </style>


</head>



<body class="loading-dashboard">
    <div id="loadingOverlay">

        <div class="spinner-flower-base spinner-flower-large" aria-hidden="true">

            <div></div>

            <div></div>

            <div></div>

            <div></div>

            <div></div>

            <div></div>

            <div></div>

            <div></div>

        </div>

    </div>
    <header>
        <div class="header-left" id="pageTitle"></div>
        <div class="header-center">

            <img src="assets/logo.png" alt="Logo" />

        </div>

        <div class="header-right">

            <div class="header-stats">

                <div class="stat-item">

                    <ion-icon name="document-text-outline"></ion-icon>

                    <span id="headerStatPosts">0 Post</span>

                </div>

                <div class="stat-item">

                    <ion-icon name="eye-outline"></ion-icon>

                    <span id="headerStatViews">0 Views</span>

                </div>

            </div>

            <button class="logout-btn" onclick="logout()">

                <ion-icon name="log-out-outline"></ion-icon>

            </button>

        </div>

    </header>



    <aside class="sidebar">

        <div class="sidebar-header">

            <img src="assets/logo.png" alt="Logo" />

        </div>

        <ul class="sidebar-nav-list">

            <li class="sidebar-nav-item">

                <a href="#" class="nav-link active" data-target="dashboardSection">

                    <ion-icon name="home-outline"></ion-icon>

                    <span>Dashboard</span>

                </a>

            </li>

            <li class="sidebar-nav-item">

                <a href="#" class="nav-link" data-target="postStatsSection">

                    <ion-icon name="stats-chart-outline"></ion-icon>

                    <span>Statistik Postingan</span>

                </a>

            </li>

            <li class="sidebar-nav-item">

                <a href="#" class="nav-link" data-target="addPostSection">

                    <ion-icon name="add-circle-outline"></ion-icon>

                    <span>Postingan Baru</span>

                </a>

            </li>

            <li class="sidebar-nav-item">

                <a href="#" class="nav-link" data-target="postListSection">

                    <ion-icon name="folder-open-outline"></ion-icon>

                    <span>Daftar Postingan</span>

                </a>

            </li>
            <li class="sidebar-nav-item">

                <a href="#" class="nav-link" data-target="settingsSection">

                    <ion-icon name="settings-outline"></ion-icon>

                    <span>Pengaturan</span>

                </a>

            </li>

            <li class="sidebar-nav-item">

                <a href="#" class="logout-link" onclick="logout()">

                    <ion-icon name="log-out-outline"></ion-icon>

                    <span>Logout</span>

                </a>

            </li>

        </ul>

    </aside>



    <div class="content-wrapper">

        <div class="main-content" id="mainContent">



            <div id="dashboardSection" class="content-section">

                <div class="greeting-section">

                    <h1 id="greeting-text-dynamic">Halo, Admin!</h1>

                </div>



                <div class="dashboard-section text-center">

                    <h2>Hai, Admin</h2>
                    <img src="assets/logo.png" alt="Logo" style="max-width: 150px; opacity: 0.7;" />

                    <p style="margin-top: 20px; font-size: 0.9em; color: var(--text-muted);">Waktu Server (Lokal): <span id="serverTime">Memuat...</span></p>

                </div>



                <div class="dashboard-section">

                    <h2>Statistik Umum</h2>

                    <div class="stat-grid">

                        <div class="stat-card">

                            <span class="stat-value" id="statCardViews">0</span>

                            <span class="stat-label">Total Views</span>

                        </div>

                        <div class="stat-card">

                            <span class="stat-value" id="statCardPosts">0</span>

                            <span class="stat-label">Jumlah Postingan</span>

                        </div>

                        <div class="stat-card">

                            <span class="stat-value" id="statCardComments">0</span>

                            <span class="stat-label">Total Komentar</span>

                        </div>

                        <div class="stat-card">

                            <span class="stat-value" id="statCardCategories">0</span>

                            <span class="stat-label">Kategori</span>

                        </div>

                    </div>

                </div>



                <div class="dashboard-section">

                    <h2>Postingan Teratas</h2>

                    <div class="data-list">

                        <ul id="topPostsList">

                            <li style="text-align: center; color: var(--text-muted);">Memuat postingan teratas...</li>

                        </ul>

                    </div>

                </div>



                <div class="dashboard-section">

                    <h2>Postingan Terbaru</h2>

                    <div class="data-list">

                        <ul id="latestPostsList">

                            <li style="text-align: center; color: var(--text-muted);">Memuat...</li>

                        </ul>

                    </div>

                </div>



                <div class="dashboard-section">

                    <h2>Aktivitas Login Terbaru (Top 5)</h2>

                    <div class="data-list">

                        <ul id="loginActivityList">

                            <li style="text-align: center; color: var(--text-muted);">Memuat...</li>

                        </ul>

                    </div>

                </div>



                <div class="dashboard-section">

                    <h2>Informasi Sistem</h2>

                    <div class="info-grid">

                        <div class="info-item">

                            <span class="info-label">Versi Dashboard:</span>

                            <span class="info-value">1.0.0</span>

                        </div>

                        <div class="info-item">

                            <span class="info-label">Terakhir Diperbarui:</span>

                            <span class="info-value" id="lastUpdatedDashboard">Memuat...</span>

                        </div>

                        <div class="info-item">

                            <span class="info-label">Firebase Project ID:</span>

                            <span class="info-value" id="firebaseProjectId">Memuat...</span>

                        </div>

                    </div>

                </div>

            </div>



            <div id="postStatsSection" class="content-section" style="display: none;">

                <div class="dashboard-section">

                    <h2>Statistik Postingan</h2>

                    <p>Lihat grafik dan data terperinci tentang performa postingan Anda di sini.</p>



                    <div class="form-group">

                        <label for="statFilterCategory">Filter Berdasarkan Kategori:</label>

                        <select id="statFilterCategory">

                            <option value="all">Semua Kategori</option>

                            </select>

                    </div>



                    <h3 style="margin-top: 30px; color: var(--text-lighter);">Views Postingan</h3>

                    <div class="chart-container">

                        <canvas id="postViewsChart"></canvas>

                        <p id="chartViewsMessage" style="text-align: center; color: var(--text-muted); margin-top: 15px; display: none;">Memuat data grafik...</p>

                    </div>



                    <h3 style="margin-top: 30px; color: var(--text-lighter);">Views per Kategori</h3>

                    <div class="chart-container">

                        <canvas id="categoryViewsChart"></canvas>

                        <p id="chartCategoryViewsMessage" style="text-align: center; color: var(--text-muted); margin-top: 15px; display: none;">Memuat data grafik...</p>

                    </div>





                    <h3 style="margin-top: 30px; color: var(--text-lighter);">Ringkasan Statistik</h3>

                    <div class="info-grid">

                        <div class="info-item">

                            <span class="info-label">Total Views Bulan Ini:</span>

                            <span class="info-value" id="monthlyViews">0</span>

                        </div>

                        <div class="info-item">

                            <span class="info-label">Postingan Populer:</span>

                            <span class="info-value" id="mostPopularPost">N/A</span>

                        </div>

                        <div class="info-item">

                            <span class="info-label">Rata-rata Komentar per Post:</span>

                            <span class="info-value" id="avgCommentsPerPost">0</span>

                        </div>

                    </div>



                    <h3 style="padding-bottom: 30px; margin-top: 30px; color: var(--text-lighter);">Top 3 Postingan Bulan Ini</h3>
                    <div class="data-list">

                        <ul id="topMonthlyPostsList">

                            <li style="text-align: center; color: var(--text-muted);">Memuat postingan...</li>

                        </ul>

                    </div>



                    <h3 style="padding-bottom: 30px; margin-top: 30px; color: var(--text-lighter);">Kategori Paling Aktif</h3>
                    <div class="data-list">

                        <ul id="mostActiveCategoriesList">

                            <li style="text-align: center; color: var(--text-muted);">Memuat...</li>

                        </ul>

                    </div>

                </div>

            </div>



            <div id="addPostSection" class="content-section" style="display: none;">

                <div class="dashboard-section">

                    <h2>Buat Postingan Baru</h2>

                    <form id="addPostForm">

                        <div class="form-group">

                            <label for="postTitle">Judul Postingan:</label>

                            <input type="text" id="postTitle" placeholder="Masukkan judul postingan" required>

                        </div>

                        <div class="form-group">

                            <label for="postCategory">Kategori:</label>

                            <select id="postCategory" required>

                                <option value="">Pilih Kategori</option>

                                </select>

                        </div>
                        
                        <div class="form-group">
							<label for="postCover">URL Cover</label>
							<input type="url" id="postCover" placeholder="https://bimaakbar.netlify.app/assets/error.jpg">
						</div>
						<div class="form-group">
							<label for="postExcerpt">Ringkasan</label>
							<input type="text" id="postExcerpt" placeholder="Boleh dikosongkan">
						</div>

                        <div class="form-group">

                            <label for="postContent">Konten Postingan:</label>

                            <textarea id="postContent" placeholder="Tulis konten postingan Anda di sini..." required></textarea>

                        </div>
                        
                        <div class="form-group">
						  <label for="postTags">Hashtags</label>
						  <input type="text" id="postTags" placeholder="tag1,tag2,tag3">
						</div>

                        <div class="form-group">

                            <label>Status:</label>

                            <div class="radio-group">

                                <input type="radio" id="statusPublished" name="postStatus" value="published" checked>

                                <label for="statusPublished">Publik</label>

                                <input type="radio" id="statusDraft" name="postStatus" value="draft">

                                <label for="statusDraft">Draf</label>

                                <input type="radio" id="statusScheduled" name="postStatus" value="scheduled">

                                <label for="statusScheduled">Terjadwal</label>

                            </div>

                        </div>
                        <div class="form-group" id="scheduleDateTimeGroup" style="display: none;">
                            <label>Jadwalkan Publikasi:</label>
                            <div class="datetime-group">
                                <div class="form-group">
                                    <label for="scheduleDate">Tanggal:</label>
                                    <input type="date" id="scheduleDate">
                                </div>
                                <div class="form-group">
                                    <label for="scheduleTime">Waktu:</label>
                                    <input type="time" id="scheduleTime">
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-submit" id="previewPostBtn" style="margin-right:10px;">Preview</button>
                        <button type="submit" class="btn-submit">Simpan</button>
                        <p id="addPostMessage" style="margin-top: 15px;"></p>
                    </form>
                    <div id="previewModal" class="modal" style="display:none;">
                        <div class="modal-content">
                            <span class="close" id="closePreviewModal">&times;</span>
                            <div id="previewContent"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="postListSection" class="content-section" style="display: none;">
                <div class="dashboard-section">
                    <h2>Daftar Semua Postingan</h2>
                    <p>Kelola semua postingan Anda: edit, lihat, atau hapus.</p>
                    <div class="post-list" id="allPostsCardList"></div>
                </div>
            </div>
            <div id="settingsSection" class="content-section" style="display: none;">
                <div class="dashboard-section">
                    <h2>Pengaturan Aplikasi</h2>
                    <p>Kelola konfigurasi umum atau akun Anda.</p>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="adminEmail">Email Admin:</label>
                            <input type="email" id="adminEmail" value="admin@example.com" readonly>
                            <small style="color: var(--text-muted);">Email ini terdaftar sebagai akun admin.</small>
                        </div>
                        <div class="form-group">
                            <label for="siteName">Nama Situs:</label>
                            <input type="text" id="siteName" placeholder="Nama Situs Anda">
                        </div>
                        <div class="form-group">
                            <label for="itemsPerPage">Item per Halaman:</label>
                            <input type="number" id="itemsPerPage" value="10" min="1" max="100">
                        </div>
                        <div class="settings-button">
    						<button type="button" class="btn-submit" id="changePasswordBtn">Ubah Password</button>
    						<button type="submit" class="btn-submit" style="margin-top: 10px;">Simpan Pengaturan</button>
    						<p id="settingsMessage" style="margin-top: 15px;"></p>
						</div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <nav class="bottom-nav">
        <a href="#" class="bottom-nav-item nav-link active" data-target="dashboardSection">
            <ion-icon name="home-outline"></ion-icon>
        </a>
        <a href="#" class="bottom-nav-item nav-link" data-target="postStatsSection">
            <ion-icon name="stats-chart-outline"></ion-icon>
        </a>
        <a href="#" class="bottom-nav-item nav-link" data-target="addPostSection">
            <ion-icon name="add-circle-outline"></ion-icon>
        </a>
        <a href="#" class="bottom-nav-item nav-link" data-target="postListSection">
            <ion-icon name="folder-open-outline"></ion-icon>
        </a>
        <a href="#" class="bottom-nav-item nav-link" data-target="settingsSection">
            <ion-icon name="settings-outline"></ion-icon>
        </a>
    </nav>
    <script>
        const firebaseConfig = {
	apiKey: "AIzaSyDtMdCf91Ihh-SlhoZHLV4Taxg2YPmks14",
  	authDomain: "bima-akbar-web.firebaseapp.com",
 	 databaseURL: "https://bima-akbar-web-default-rtdb.asia-southeast1.firebasedatabase.app",
  	projectId: "bima-akbar-web",
  	storageBucket: "bima-akbar-web.firebasestorage.app",
  	messagingSenderId: "521611265429",
  	appId: "1:521611265429:web:9e6c64385b5abcbad6e29c",
  	measurementId: "G-ZHKJ22MFVE"
};
// Initialize Firebase

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();
// --- End Firebase Configuration ---

// --- Global Elements ---
const mainContent = document.getElementById('mainContent');
const loadingOverlay = document.getElementById('loadingOverlay');
const body = document.body;
const userNameDisplayMobile = document.getElementById('pageTitle').textContent = "Dashboard";
let activeUserEmailPart = 'Admin'; // To store user email part for dynamic greeting
let myChart; // Global variable to hold the Chart.js instance for post views
let myCategoryChart; // Global variable to hold the Chart.js instance for category views
let editingPostId = null;

const headerStatPosts = document.getElementById('headerStatPosts');

const headerStatViews = document.getElementById('headerStatViews');

// --- End Global Elements ---



// --- Logout Function ---
const logout = () => {
	auth.signOut()
		.then(() => {
			window.location.href = 'login.html';
		})
		.catch((error) => {
			alert(`Gagal logout: ${error.message}`);
		});
};



// Function to update server time (client-side time for demonstration)

const updateServerTime = () => {

	const now = new Date();

	const options = {

		weekday: 'long',

		year: 'numeric',

		month: 'long',

		day: 'numeric',

		hour: '2-digit',

		minute: '2-digit',

		second: '2-digit',

		timeZoneName: 'short',

		timeZone: 'Asia/Jakarta'

	};

	const serverTimeElement = document.getElementById('serverTime');

	if (serverTimeElement) {

		serverTimeElement.textContent = now.toLocaleString('id-ID', options);

	}

};



// --- Auth State Change Listener for Dashboard (PENTING UNTUK PROTEKSI) ---

auth.onAuthStateChanged((user) => {

	if (!user) {

		window.location.href = 'login.html';

	} else {

		activeUserEmailPart = user.email ? user.email.split('@')[0] : 'Admin';

		// Load initial content based on URL or default

		const urlParams = new URLSearchParams(window.location.search);

		const initialPage = urlParams.get('page') || 'dashboard';

		const initialTargetId = `${initialPage}Section`;

		loadContent(initialTargetId); // Panggil loadContent setelah user terautentikasi



		// Hide loading overlay with fade-out

		loadingOverlay.classList.add('hidden');

		loadingOverlay.addEventListener('transitionend', function handler() {

			loadingOverlay.style.display = 'none';

			body.classList.remove('loading-dashboard');

			loadingOverlay.removeEventListener('transitionend', handler);

		}, {

			once: true

		});



		// Update last login time in database (optional, but good for tracking)

		database.ref(`BimaAkbar/users/${user.uid}`).update({ //
			lastLogin: firebase.database.ServerValue.TIMESTAMP
		});


		// Log activity for successful login (only when dashboard is loaded)

		database.ref('BimaAkbar/login_activities').push({ //
			userId: user.uid,
			message: `Berhasil login ke dashboard: ${user.email}`,
			timestamp: firebase.database.ServerValue.TIMESTAMP,
			type: 'login'
		});


		// Initialize header stats listener

		initHeaderStats();

	}

});



// --- Content Loading & Initialization Logic (MODULARIZED) ---

const navLinks = document.querySelectorAll('.nav-link');

const contentSections = document.querySelectorAll('.content-section');



// Object to store active Firebase listener references

const activeFirebaseListeners = {};



// Function to stop all active Firebase listeners for a specific section

function stopSectionListeners(sectionId) {

	if (activeFirebaseListeners[sectionId]) {

		activeFirebaseListeners[sectionId].forEach(listener => {

			if (listener.ref && listener.eventType && listener.callback) {

				listener.ref.off(listener.eventType, listener.callback);

			}

		});

		activeFirebaseListeners[sectionId] = []; // Clear listeners for this section

	}

}



// Helper to register a Firebase listener

function registerListener(sectionId, path, eventType, callback) {

	const ref = database.ref(`BimaAkbar/${path}`); //
	ref.on(eventType, callback);

	if (!activeFirebaseListeners[sectionId]) {

		activeFirebaseListeners[sectionId] = [];

	}

	activeFirebaseListeners[sectionId].push({

		ref, // Store the reference

		path,

		eventType,

		callback

	});

	return ref; // Return ref if needed for specific detach later

}



function loadContent(targetSectionId) {

	// Stop listeners from ALL previously active sections

	Object.keys(activeFirebaseListeners).forEach(sectionId => {

		stopSectionListeners(sectionId);

	});

	// Stop global dashboard interval

	if (window.serverTimeInterval) {

		clearInterval(window.serverTimeInterval);

		window.serverTimeInterval = null; // Clear reference

	}

	// Destroy Chart.js instances if they exist

	if (myChart) {

		myChart.destroy();

		myChart = null;

	}

	if (myCategoryChart) {

		myCategoryChart.destroy();

		myCategoryChart = null;

	}



	// Sembunyikan semua section

	contentSections.forEach(section => {

		section.style.display = 'none';

	});



	// Tampilkan section yang ditargetkan

	const targetSection = document.getElementById(targetSectionId);

	if (targetSection) {

		targetSection.style.display = 'block';

	}



	// Perbarui kelas 'active' untuk semua elemen navigasi

	navLinks.forEach(item => item.classList.remove('active'));

	const currentLink = document.querySelector(`.nav-link[data-target="${targetSectionId}"]`);

	if (currentLink) {

		currentLink.classList.add('active');

	}

	console.log('Target Section ID:', targetSectionId);



	// Panggil fungsi inisialisasi spesifik untuk section yang aktif

	switch (targetSectionId) {

		case 'dashboardSection':

			initDashboardSection();

			break;

		case 'postStatsSection':

			initPostStatsSection();

			break;

		case 'addPostSection':

			initAddPostSection();

			break;

		case 'postListSection':

			initPostListSection();

			break;

		case 'settingsSection':

			initSettingsSection();

			break;

		default:

			// Fallback or error handling

			console.warn(`Unknown section ID: ${targetSectionId}`);

			break;

	}



	// Update URL tanpa reload (untuk riwayat browser)

	history.pushState(null, '', `dashboard.html?page=${targetSectionId.replace('Section', '')}`);

}



// --- Header Stats (New Feature) ---

function initHeaderStats() {

	const postsRef = database.ref('BimaAkbar/posts'); //
	
	// Listener for total posts and total views

	registerListener('headerStats', 'posts', 'value', (snapshot) => {

		const posts = snapshot.val();

		let postCount = 0;

		let totalViews = 0;

		if (posts) {

			postCount = Object.keys(posts).length;

			Object.values(posts).forEach(post => {

				totalViews += (post.views || 0);

			});

		}

		if (headerStatPosts) headerStatPosts.textContent = `${postCount} Post`;

		if (headerStatViews) headerStatViews.textContent = `${totalViews.toLocaleString('id-ID')} Views`;

	});

}



// --- Initialization Functions for Each Section ---



function initDashboardSection() {

	// Update greeting for the dynamically loaded dashboard content

	const dynamicGreetingH1 = document.getElementById("greeting-text-dynamic");

	if (dynamicGreetingH1) {

		dynamicGreetingH1.textContent = `Halo, ${activeUserEmailPart}.`;

	}



	// Update server time

	updateServerTime();

	window.serverTimeInterval = setInterval(updateServerTime, 1000);



	// Update "Last Updated" timestamp

	const lastUpdatedDashboard = document.getElementById('lastUpdatedDashboard');

	if (lastUpdatedDashboard) {

		const now = new Date();

		const options = {

			year: 'numeric',

			month: 'long',

			day: 'numeric',

			hour: '2-digit',

			minute: '2-digit'

		};

		lastUpdatedDashboard.textContent = now.toLocaleString('id-ID', options);

	}



	// Update Firebase Project ID

	const firebaseProjectIdElement = document.getElementById('firebaseProjectId');

	if (firebaseProjectIdElement) {

		firebaseProjectIdElement.textContent = firebaseConfig.projectId;

	}



	// Inisialisasi elemen statistik dan daftar

	const statCardViewsElement = document.getElementById('statCardViews');

	const statValueViews = statCardViewsElement;



	const statCardPostsElement = document.getElementById('statCardPosts');

	const statValuePosts = statCardPostsElement;



	const statCardCommentsElement = document.getElementById('statCardComments');

	const statValueComments = statCardCommentsElement;



	const statCardCategoriesElement = document.getElementById('statCardCategories');

	const statValueCategories = statCardCategoriesElement;



	const topPostsList = document.getElementById('topPostsList');

	const latestPostsList = document.getElementById('latestPostsList');

	const loginActivityList = document.getElementById('loginActivityList');



	const updateStatCard = (valueElement, data) => {

		if (valueElement) {

			valueElement.textContent = (data !== null && data !== undefined) ? data.toLocaleString('id-ID') : '0';

		}

	};



	// Firebase data listeners for dashboard content

	// Stats Listener (Posts & Views)

	if (statValueViews && statValuePosts) {

		registerListener('dashboardSection', 'posts', 'value', (snapshot) => { //
			const posts = snapshot.val();

			let totalViews = 0;

			let postCount = 0;

			if (posts) {

				postCount = Object.keys(posts).length;

				Object.values(posts).forEach(post => {

					totalViews += (post.views || 0);

				});

			}

			updateStatCard(statValueViews, totalViews);

			updateStatCard(statValuePosts, postCount);

		});

	}



	// Comments Listener

	if (statValueComments) {

		registerListener('dashboardSection', 'comments', 'value', (snapshot) => { //
			const comments = snapshot.val();

			updateStatCard(statValueComments, comments ? Object.keys(comments).length : 0);

		});

	}



	// Categories Listener

	if (statValueCategories) {

		registerListener('dashboardSection', 'categories', 'value', (snapshot) => { //
			const categories = snapshot.val();

			updateStatCard(statValueCategories, categories ? Object.keys(categories).length : 0);

		});

	}



	// Top Posts Listener (Adding Comments & Status)

	if (topPostsList) {

		registerListener('dashboardSection', 'posts', 'value', (snapshot) => { //
			const posts = snapshot.val();

			topPostsList.innerHTML = '';

			if (posts) {

				const postsArray = Object.keys(posts).map(key => ({

					id: key,

					...posts[key]

				}));

				postsArray.sort((a, b) => b.views - a.views); // Sort by views descending

				const top5Posts = postsArray.slice(0, 5); // Take top 5



				if (top5Posts.length > 0) {

					top5Posts.forEach(post => {

						const li = document.createElement('li');

						const postDate = new Date(post.timestamp).toLocaleDateString('id-ID', {

							year: 'numeric',

							month: 'short',

							day: 'numeric'

						});

						// Fetch comment count for this post (this is a simplified approach,

						// a more efficient way would be to denormalize comment counts in post data)

						let commentCount = 0;

						database.ref('BimaAkbar/comments').orderByChild('postId').equalTo(post.id).once('value', commentSnap => { //
							commentCount = commentSnap.exists() ? Object.keys(commentSnap.val()).length : 0;



							let statusText = post.status === 'published' ? 'Publikasi' : (post.status === 'scheduled' ? 'Terjadwal' : 'Draf');

							if (post.status === 'scheduled' && post.scheduledTimestamp && new Date(post.scheduledTimestamp) < new Date()) {

								statusText = 'Terjadwal (Terlewat)';

							}



							li.innerHTML = `

								<div class="post-details">

									<span class="post-title">${post.title || 'Judul Tidak Ada'}</span>

									<div class="post-meta">

										<span>Kategori: ${post.category || 'Belum ada'}</span>

										<span>&bull; Status: ${statusText}</span>

										<span>&bull; Komentar: ${commentCount}</span>

										<span>&bull; ${postDate}</span>

									</div>

								</div>

								<div class="post-stats">

									<div class="stat-value">${(post.views || 0).toLocaleString('id-ID')}</div>

									<div class="stat-label">Views</div>

								</div>

							`;

							topPostsList.appendChild(li); // Append after comments are fetched

						});

					});

				} else {

					topPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93;">Belum ada postingan teratas.</li>';

				}

			} else {

				topPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada postingan teratas.</li>';

			}

		});

	}



	// Latest Posts Listener

	if (latestPostsList) {

		registerListener('dashboardSection', 'posts', 'value', (snapshot) => { //
			const posts = snapshot.val();

			latestPostsList.innerHTML = '';

			if (posts) {

				const postsArray = Object.keys(posts).map(key => ({

					id: key,

					...posts[key]

				}));

				postsArray.sort((a, b) => b.timestamp - a.timestamp); // Sort by latest timestamp descending

				const latest5Posts = postsArray.slice(0, 5); // Take latest 5



				if (latest5Posts.length > 0) {

					latest5Posts.forEach(post => {

						const li = document.createElement('li');

						const postDate = new Date(post.timestamp).toLocaleDateString('id-ID', {

							year: 'numeric',

							month: 'short',

							day: 'numeric'

						});

						let statusText = post.status === 'published' ? 'Publikasi' : (post.status === 'scheduled' ? 'Terjadwal' : 'Draf');

						if (post.status === 'scheduled' && post.scheduledTimestamp && new Date(post.scheduledTimestamp) < new Date()) {

							statusText = 'Terjadwal (Terlewat)';

						}
						
						// Added `editPost` and `viewPost` functions
						li.innerHTML = `
							<div>
								<span class="item-title">${post.title || 'Judul Tidak Ada'}</span>
								<div class="item-meta">
									<span>Kategori: ${post.category || 'Belum ada'}</span>
									<span>&bull; Status: ${statusText}</span>
									${post.scheduledTimestamp ? `<span>&bull; Jadwal: ${new Date(post.scheduledTimestamp).toLocaleString('id-ID')}</span>` : ''}
									<span>&bull; ${postDate}</span>
								</div>
							</div>
							<div class="actions">
								<button onclick="editPost('${post.id}')"><ion-icon name="create"></ion-icon> Edit</button>
								<button onclick="viewPost('${post.slug || post.id}')"><ion-icon name="eye"></ion-icon> Lihat</button>
							</div>
						`;

						latestPostsList.appendChild(li);

					});

				} else {

					latestPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada postingan terbaru.</li>';

				}

			} else {

				latestPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada postingan terbaru.</li>';

			}

		});

	}



	// Login Activity Listener

	if (loginActivityList) {

		registerListener('dashboardSection', 'login_activities', 'value', (snapshot) => { //
			const activities = snapshot.val();

			loginActivityList.innerHTML = '';

			if (activities) {

				const activitiesArray = Object.keys(activities).map(key => ({

					id: key,

					...activities[key]

				}));

				activitiesArray.sort((a, b) => b.timestamp - a.timestamp); // Sort by latest timestamp descending

				const latest5Activities = activitiesArray.slice(0, 5); // Take latest 5



				if (latest5Activities.length > 0) {

					latest5Activities.forEach(activity => {

						const li = document.createElement('li');

						const activityTime = new Date(activity.timestamp).toLocaleString('id-ID', {

							year: 'numeric',

							month: 'short',

							day: 'numeric',

							hour: '2-digit',

							minute: '2-digit'

						});

						li.classList.add('activity-item');

						li.innerHTML = `

							<span class="log-time">${activityTime}</span>

							<span class="log-message">${activity.message}</span>

						`;

						loginActivityList.appendChild(li);

					});

				} else {

					loginActivityList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada aktivitas login.</li>';

				}

			} else {

				loginActivityList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada aktivitas login.</li>';

			}

		});

	}

}



function initPostStatsSection() {

	console.log('Menginisialisasi Statistik Postingan...');

	stopSectionListeners('postStatsSection'); // Stop any previous listeners specific to this section



	const statFilterCategory = document.getElementById('statFilterCategory');

	const postViewsChartCtx = document.getElementById('postViewsChart').getContext('2d');

	const categoryViewsChartCtx = document.getElementById('categoryViewsChart').getContext('2d');

	const chartViewsMessage = document.getElementById('chartViewsMessage');

	const chartCategoryViewsMessage = document.getElementById('chartCategoryViewsMessage');

	const topMonthlyPostsList = document.getElementById('topMonthlyPostsList');

	const mostActiveCategoriesList = document.getElementById('mostActiveCategoriesList');





	chartViewsMessage.style.display = 'block';

	chartViewsMessage.textContent = 'Memuat data grafik Views Postingan...';

	chartCategoryViewsMessage.style.display = 'block';

	chartCategoryViewsMessage.textContent = 'Memuat data grafik Views per Kategori...';

	topMonthlyPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93">Memuat postingan...</li>';

	mostActiveCategoriesList.innerHTML = '<li style="text-align: center; color: #8E8E93">Memuat kategori...</li>';



	if (myChart) myChart.destroy();

	if (myCategoryChart) myCategoryChart.destroy();



	const updateChartsAndStats = (filterCategory = 'all') => {

		registerListener('postStatsSection', 'posts', 'value', (snapshot) => { //
			const posts = snapshot.val();

			let postLabels = [];

			let postViewsData = [];

			let totalMonthlyViews = 0;

			let popularPostTitle = 'N/A';

			let maxViews = -1;

			
			let categoryViews = {}; // For category views chart

			let categoryPostCounts = {}; // For most active categories



			const now = new Date();

			const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();



			if (posts) {

				const postsArray = Object.keys(posts).map(key => ({ id: key, ...posts[key] }));

				let monthlyPosts = [];



				postsArray.forEach(post => {

					// Calculate monthly views

					const postTimestamp = post.timestamp;

					if (postTimestamp && postTimestamp >= firstDayOfMonth) {

						totalMonthlyViews += (post.views || 0);

						monthlyPosts.push(post);

					}



					// Prepare data for individual post views chart (filtered by category)

					if (filterCategory === 'all' || post.category === filterCategory) {

						postLabels.push(post.title || `Post ${post.id.substring(0, 5)}`);

						postViewsData.push(post.views || 0);

						if ((post.views || 0) > maxViews) {

							maxViews = (post.views || 0);

							popularPostTitle = post.title || 'N/A';

						}

					}



					// Accumulate views per category for category views chart

					if (post.category) {

						categoryViews[post.category] = (categoryViews[post.category] || 0) + (post.views || 0);

						categoryPostCounts[post.category] = (categoryPostCounts[post.category] || 0) + 1;

					}

				});

				
				// Sort individual post data for chart readability

				const sortedPostData = postLabels.map((label, index) => ({

					label: label,

					views: postViewsData[index]

				})).sort((a, b) => b.views - a.views);



				postLabels = sortedPostData.map(item => item.label);

				postViewsData = sortedPostData.map(item => item.views);



				// Render Top 3 Monthly Posts

				monthlyPosts.sort((a, b) => b.views - a.views);

				const top3Monthly = monthlyPosts.slice(0, 3);

				topMonthlyPostsList.innerHTML = '';

				if (top3Monthly.length > 0) {

					top3Monthly.forEach(post => {

						const li = document.createElement('li');

						li.innerHTML = `

							<div class="post-details">

								<span class="post-title">${post.title || 'Judul Tidak Ada'}</span>

								<div class="post-meta">

									<span>Views: ${(post.views || 0).toLocaleString('id-ID')}</span>

									<span>&bull; Kategori: ${post.category || 'Belum ada'}</span>

								</div>

							</div>

						`;

						topMonthlyPostsList.appendChild(li);

					});

				} else {

					topMonthlyPostsList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada postingan bulan ini.</li>';

				}



				// Render Most Active Categories

				const sortedCategories = Object.keys(categoryPostCounts).map(key => ({

					name: key,

					count: categoryPostCounts[key]

				})).sort((a, b) => b.count - a.count);

				
				const top3Categories = sortedCategories.slice(0, 3);

				mostActiveCategoriesList.innerHTML = '';

				if (top3Categories.length > 0) {

					top3Categories.forEach(cat => {

						const li = document.createElement('li');

						li.innerHTML = `

							<div>

								<span class="item-title">${cat.name}</span>

								<div class="item-meta">

									<span>Jumlah Postingan: ${cat.count}</span>

								</div>

							</div>

						`;

						mostActiveCategoriesList.appendChild(li);

					});

				} else {

					mostActiveCategoriesList.innerHTML = '<li style="text-align: center; color: #8E8E93">Belum ada kategori aktif.</li>';

				}




			} else {

				postLabels = ['No Data'];

				postViewsData = [0];

				chartViewsMessage.textContent = 'Tidak ada data postingan untuk ditampilkan.';

			}



			// Calculate average comments (still requires actual comment data per post, simplified for now)

			let totalComments = 0;

			let numPostsWithComments = 0;

			database.ref('BimaAkbar/comments').once('value').then(commentSnapshot => { //
				const comments = commentSnapshot.val();

				if (comments) {

					const commentsArray = Object.values(comments);

					totalComments = commentsArray.length;

					const uniquePostIdsWithComments = new Set(commentsArray.map(comment => comment.postId));

					numPostsWithComments = uniquePostIdsWithComments.size;

				}

				const avgComments = numPostsWithComments > 0 ? (totalComments / numPostsWithComments).toFixed(1) : 0;

				document.getElementById('avgCommentsPerPost').textContent = avgComments;

			});



			// Update summary stats

			document.getElementById('monthlyViews').textContent = totalMonthlyViews.toLocaleString('id-ID');

			document.getElementById('mostPopularPost').textContent = popularPostTitle;



			// Chart 1: Post Views

			if (myChart) myChart.destroy();

			myChart = new Chart(postViewsChartCtx, {
				type: 'bar',
				data: {
					labels: postLabels,
					datasets: [{
						label: 'Jumlah Views',
						data: postViewsData,
						backgroundColor: [
							'#0A84FF', '#5AC8FA', '#FFD60A', '#FF375F', '#30D158', '#BF5AF2', '#FFA500', '#FF69B4'
						],
						borderColor: '#1C1C1E',
						borderWidth: 2
					}]
				},
				options: {
					indexAxis: 'x', // INI YANG MEMBUATNYA HORIZONTAL
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						x: {
							grid: { color: 'rgba(255,255,255,0.1)' },
							ticks: { color: '#8E8E93', callback: value => value.toLocaleString('id-ID') }
						},
						y: {
							grid: { color: 'rgba(255,255,255,0.1)' },
							ticks: { color: '#8E8E93' }
						}
					},
					plugins: {
						legend: { labels: { color: '#E0E0E0' } },
						tooltip: {
							backgroundColor: '#1C1C1E',
							titleColor: '#FFFFFF',
							bodyColor: '#E0E0E0',
							borderColor: '#0A84FF',
							borderWidth: 1,
							callbacks: {
								label: function(context) {
									let label = context.label || '';
									if (label) label += ': ';
									if (context.parsed.x !== null) {
										label += context.parsed.x.toLocaleString('id-ID') + ' views';
									}
									return label;
								}
							}
						}
					},
					animation: { duration: 1200, easing: 'easeOutBounce' }
				}
			});

			chartViewsMessage.style.display = 'none';



			// Chart 2: Category Views

			if (myCategoryChart) myCategoryChart.destroy();

			const categoryLabels = Object.keys(categoryViews);

			const categoryViewsData = Object.values(categoryViews);



			myCategoryChart = new Chart(categoryViewsChartCtx, {
				type: 'radar',
				data: {
					labels: categoryLabels,
					datasets: [{
						label: 'Views per Kategori',
						data: categoryViewsData,
						backgroundColor: 'rgba(10,132,255,0.3)',
						borderColor: '#0A84FF',
						pointBackgroundColor: '#5AC8FA',
						borderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: {
							labels: { color: '#E0E0E0' }
						},
						tooltip: {
							backgroundColor: 'rgba(28, 28, 30, 0.9)',
							titleColor: '#FFFFFF',
							bodyColor: '#E0E0E0',
							borderColor: 'var(--primary-color)',
							borderWidth: 1,
							callbacks: {
								label: function(context) {
									let label = context.label || '';
									if (label) label += ': ';
									if (context.parsed !== null) {
										label += context.parsed.toLocaleString('id-ID') + ' views';
									}
									return label;
								}
							}
						}
					},
					animation: { duration: 1000, easing: 'easeOutQuart' },
					scales: {
						r: {
							angleLines: { color: '#8E8E93' },
							grid: { color: 'rgba(255,255,255,0.1)' },
							pointLabels: { color: '#E0E0E0' },
							ticks: {
								color: '#8E8E93',
								backdropColor: 'transparent',
								callback: function(value) { return value.toLocaleString('id-ID'); }
							}
						}
					}
				}
			});

			chartCategoryViewsMessage.style.display = 'none';



		});

	};



	// Initial chart load

	updateChartsAndStats('all');



	// Handle filter change

	if (statFilterCategory) {

		if (window.statFilterCategoryChangeHandler) {

			statFilterCategory.removeEventListener('change', window.statFilterCategoryChangeHandler);

		}

		window.statFilterCategoryChangeHandler = (event) => {

			updateChartsAndStats(event.target.value);

		};

		statFilterCategory.addEventListener('change', window.statFilterCategoryChangeHandler);

	}



	// Populate category filter dropdown

	if (statFilterCategory) {

		 registerListener('postStatsSection', 'categories', 'value', (snapshot) => { //
			const categories = snapshot.val();

			// Clear existing options except 'Semua Kategori'

			statFilterCategory.querySelectorAll('option:not([value="all"])').forEach(option => option.remove());

			if (categories) {

				// Convert categories object to array for sorting by name

				const categoryArray = Object.keys(categories).map(key => ({ id: key, ...categories[key] }));

				categoryArray.sort((a, b) => a.name.localeCompare(b.name)); // Sort alphabetically



				categoryArray.forEach(cat => {

					const option = document.createElement('option');

					option.value = cat.name; // Use original case for value if filtering by exact name

					option.textContent = cat.name;

					statFilterCategory.appendChild(option);

				});

			}

		 });

	}

}



function initAddPostSection() {

	console.log('Menginisialisasi Buat Postingan Baru...');

	stopSectionListeners('addPostSection'); // Stop any previous listeners specific to this section



	const addPostForm = document.getElementById('addPostForm');
	const addPostMessage = document.getElementById('addPostMessage');
	const postCategorySelect = document.getElementById('postCategory');
	const statusRadios = document.querySelectorAll('input[name="postStatus"]');
	const scheduleDateTimeGroup = document.getElementById('scheduleDateTimeGroup');
	const scheduleDateInput = document.getElementById('scheduleDate');
	const scheduleTimeInput = document.getElementById('scheduleTime');
	const previewBtn = document.getElementById('previewPostBtn');
	const previewModal = document.getElementById('previewModal');
	const previewContent = document.getElementById('previewContent');
	const closePreviewModal = document.getElementById('closePreviewModal');

	// Preview Post
	if (previewBtn && previewModal && previewContent && closePreviewModal) {
	previewBtn.onclick = function() {
		// Ambil data dari input form
		const title = document.getElementById('postTitle').value.trim();
		const category = document.getElementById('postCategory').value;
		const content = document.getElementById('postContent').value.trim();
		const cover = document.getElementById('postCover') ? document.getElementById('postCover').value.trim() : '';
		const excerpt = document.getElementById('postExcerpt') ? document.getElementById('postExcerpt').value.trim() : '';
		const hashtags = document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t.length > 0);

		// Render preview HTML (bisa kamu desain sendiri)
		previewContent.innerHTML = `
		<h2>${title || '(Tanpa Judul)'}</h2>
		<p><strong>Kategori:</strong> ${category || '-'}</p>
		${cover ? `<img src="${cover}" alt="cover" style="max-width:100%;margin-bottom:10px;">` : ''}
		<div style="margin:1em 0;">${content.replace(/\n/g, '<br>')}</div>
		${excerpt ? `<div style="color:#888;font-style:italic;">${excerpt}</div>` : ''}
		${hashtags.length ? `<div style="margin-top:10px;"><b>Tags:</b> ${hashtags.join(', ')}</div>` : ''}
		`;

		previewModal.style.display = 'block';
	};

	closePreviewModal.onclick = function() {
		previewModal.style.display = 'none';
	};

	// Tutup modal jika klik di luar modal-content
	window.onclick = function(event) {
		if (event.target == previewModal) {
		previewModal.style.display = 'none';
		}
	};
	}



	// --- Fill Category Dropdown from Firebase ---

	if (postCategorySelect) {

		postCategorySelect.querySelectorAll('option:not([value=""])').forEach(option => option.remove()); // Clear

		registerListener('addPostSection', 'categories', 'value', (snapshot) => { //
			const categories = snapshot.val();

			if (categories) {

				const categoryArray = Object.keys(categories).map(key => ({ id: key, ...categories[key] }));

				categoryArray.sort((a, b) => a.name.localeCompare(b.name)); // Sort alphabetically



				categoryArray.forEach(cat => {

					const option = document.createElement('option');

					option.value = cat.name;

					option.textContent = cat.name;

					postCategorySelect.appendChild(option);

				});

			} else {

				console.warn("No categories found in Firebase. Please add some categories first.");

			}

		});

	}



	// --- Toggle Schedule Date/Time Input Based on Status ---

	const toggleScheduleInputs = () => {

		if (document.getElementById('statusScheduled').checked) {

			scheduleDateTimeGroup.style.display = 'block';

			scheduleDateInput.setAttribute('required', 'true');

			scheduleTimeInput.setAttribute('required', 'true');



			const now = new Date();

			now.setHours(now.getHours() + 1);

			const defaultDate = now.toISOString().split('T')[0];

			const defaultTime = now.toTimeString().split(' ')[0].substring(0, 5);



			if (!scheduleDateInput.value) scheduleDateInput.value = defaultDate;

			if (!scheduleTimeInput.value) scheduleTimeInput.value = defaultTime;



		} else {

			scheduleDateTimeGroup.style.display = 'none';

			scheduleDateInput.removeAttribute('required');

			scheduleTimeInput.removeAttribute('required');

		}

	};



	statusRadios.forEach(radio => {

		if (window.statusRadioChangeHandler) { // Remove if exists

			 radio.removeEventListener('change', window.statusRadioChangeHandler);

		}

		window.statusRadioChangeHandler = toggleScheduleInputs;

		radio.addEventListener('change', toggleScheduleInputs);

	});

	toggleScheduleInputs(); // Initial call



	// --- Handle Form Submission ---

	if (addPostForm) {

		if (window.addPostFormSubmitHandler) { // Remove if exists

			addPostForm.removeEventListener('submit', window.addPostFormSubmitHandler);

		}



		window.addPostFormSubmitHandler = (event) => {
			event.preventDefault();
		
			const title = document.getElementById('postTitle').value.trim();
			const category = postCategorySelect.value;
			const content = document.getElementById('postContent').value.trim();
			const status = document.querySelector('input[name="postStatus"]:checked').value;
			const cover = document.getElementById('postCover') ? document.getElementById('postCover').value.trim() : '';
			const excerpt = document.getElementById('postExcerpt') ? document.getElementById('postExcerpt').value.trim() : '';
			const slug = generateSlug(title);
			const hashtags = document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t.length > 0);
		
			let scheduledTimestamp = null;
			if (status === 'scheduled') {
			  const scheduleDate = scheduleDateInput.value;
			  const scheduleTime = scheduleTimeInput.value;
		
			  if (!scheduleDate || !scheduleTime) {
				addPostMessage.textContent = 'Tanggal dan waktu jadwal harus diisi!';
				addPostMessage.style.color = 'red';
				return;
			  }
			  scheduledTimestamp = new Date(`${scheduleDate}T${scheduleTime}`).getTime();
			  if (isNaN(scheduledTimestamp)) {
				addPostMessage.textContent = 'Format tanggal atau waktu jadwal tidak valid.';
				addPostMessage.style.color = 'red';
				return;
			  }
			  if (scheduledTimestamp <= Date.now()) {
				addPostMessage.textContent = 'Waktu jadwal harus di masa depan.';
				addPostMessage.style.color = 'red';
				return;
			  }
			}
		
			if (!title || !category || !content) {
			  addPostMessage.textContent = 'Judul, kategori, dan konten harus diisi!';
			  addPostMessage.style.color = 'red';
			  return;
			}
		
			addPostMessage.textContent = (editingPostId ? 'Menyimpan perubahan...' : 'Menyimpan postingan...');
			addPostMessage.style.color = '#8E8E93';
		
			const postData = {
			  title,
			  category,
			  content,
			  status,
			  views: 0,
			  timestamp: editingPostId ? undefined : firebase.database.ServerValue.TIMESTAMP,
			  authorId: auth.currentUser ? auth.currentUser.uid : 'anonymous',
			  cover: cover || null,
			  excerpt: excerpt || content.substring(0, 120),
			  slug,
			  hashtags
			};
			if (scheduledTimestamp) postData.scheduledTimestamp = scheduledTimestamp;
		
			if (editingPostId) {
			  // MODE EDIT: update post
			  // Jangan update views, timestamp, authorId jika tidak diperlukan!
			  delete postData.views;
			  delete postData.timestamp;
			  delete postData.authorId;
		
			  database.ref('BimaAkbar/posts/' + editingPostId)
				.update(postData)
				.then(() => {
				  addPostMessage.textContent = 'Postingan berhasil di-update!';
				  addPostMessage.style.color = '#0A84FF';
				  editingPostId = null;
				  // Reset form
				  addPostForm.reset();
				  document.getElementById('statusPublished').checked = true;
				  if (document.getElementById('formTitle')) document.getElementById('formTitle').textContent = "Buat Postingan Baru";
				  // Kembali ke daftar postingan:
				  loadContent('postListSection');
				})
				.catch(error => {
				  addPostMessage.textContent = `Gagal update postingan: ${error.message}`;
				  addPostMessage.style.color = 'red';
				});
			} else {
			  // MODE TAMBAH: push baru
			  database.ref('BimaAkbar/posts').push(postData)
				.then(() => {
				  addPostMessage.textContent = 'Postingan berhasil disimpan!';
				  addPostMessage.style.color = '#0A84FF';
				  addPostForm.reset();
				  document.getElementById('statusPublished').checked = true;
				  if (document.getElementById('formTitle')) document.getElementById('formTitle').textContent = "Buat Postingan Baru";
				})
				.catch(error => {
				  addPostMessage.textContent = `Gagal menyimpan postingan: ${error.message}`;
				  addPostMessage.style.color = 'red';
				});
			}
		  };
		
		  addPostForm.addEventListener('submit', window.addPostFormSubmitHandler);
		}

}

function generateSlug(text) {
		return text.toString().toLowerCase()
		.replace(/\s+/g, '-')
		.replace(/[^\w\-]+/g, '')
		.replace(/\-\-+/g, '-')
		.replace(/^-+/, '')             // Hapus - di awal
		.replace(/-+$/, '');            // Hapus - di akhir
}



function initPostListSection() {
	console.log('Menginisialisasi Daftar Postingan...');
	stopSectionListeners('postListSection');
		
	function renderPostsCard(posts) {
		const cardList = document.getElementById("allPostsCardList");
		cardList.innerHTML = "";
		
		if (!posts || !posts.length) {
			cardList.innerHTML = `<div style="color:#bdbdbd;text-align:center;padding:1.5em;">Belum ada postingan</div>`;
			return;
		}
posts.forEach(post => {
	const card = document.createElement("div");
	card.className = "post-card";
	card.innerHTML = `<div class="post-card-title">${post.title || "(Tanpa Judul)"}</div>
		<div class="post-card-meta">
			<span>Kategori: <strong>${post.category || "-"}</strong></span>
			<span>Status: <strong>${post.status || "-"}</strong></span>
			<span>Views: <strong>${post.views ?? 0}</strong></span>
			<span>Tanggal: <strong>${post.timestamp ? new Date(post.timestamp).toLocaleDateString('id-ID') : "-"}</strong></span>
			<span>Slug: <strong>${post.slug || "-"}</strong></span>
		</div>
		${post.hashtags ? `<div class="post-card-hashtags">${Array.isArray(post.hashtags) ? post.hashtags.join(', ') : post.hashtags}</div>` : ""}
		<div class="post-card-actions">
			<button onclick="editPost('${post.id}')">Edit</button>
			<button onclick="viewPost('${post.slug || post.id}')">Lihat</button>
			<button class="delete" onclick="deletePost('${post.id}')">Hapus</button>
		</div>`;
	cardList.appendChild(card);
});
}

const cardList = document.getElementById("allPostsCardList");
if (cardList) {
cardList.innerHTML = `<div style="color:#8E8E93;text-align:center;padding:1.5em;">Memuat daftar postingan...</div>`;
}

registerListener('postListSection', 'posts', 'value', (snapshot) => {
const posts = snapshot.val();
if (posts) {
	const postsArray = Object.keys(posts).map(key => ({
		id: key,
		...posts[key]
	})).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
	renderPostsCard(postsArray);
} else {
	renderPostsCard([]);
}
});
}



// Fungsi Global untuk Menghapus Postingan (dapat dipanggil dari tombol)
function deletePost(postId) {
	if (confirm('Apakah Anda yakin ingin menghapus postingan ini? Tindakan ini tidak dapat dibatalkan.')) {
		database.ref('BimaAkbar/posts/' + postId).remove() //
			.then(() => {
				alert('Postingan berhasil dihapus!');
			})
			.catch(error => {
				alert(`Gagal menghapus postingan: ${error.message}`);
				console.error("Error deleting post:", error);
			});
	}
}
window.deletePost = deletePost;

// New: Function to handle editing a post
function editPost(postId) {
	editingPostId = postId; // set mode edit
  
	// Ambil data post dari Firebase
	database.ref('BimaAkbar/posts/' + postId).once('value').then(snapshot => {
	  const postData = snapshot.val();
	  if (postData) {
		// Pindah ke section form tambah/ubah
		loadContent('addPostSection');
  
		// Tunggu form render, lalu isi field
		setTimeout(() => {
		  document.getElementById('postTitle').value = postData.title || '';
		  document.getElementById('postContent').value = postData.content || '';
		  document.getElementById('postCategory').value = postData.category || '';
		  if (document.getElementById('postExcerpt')) document.getElementById('postExcerpt').value = postData.excerpt || '';
		  if (document.getElementById('postCover')) document.getElementById('postCover').value = postData.cover || '';
		  document.getElementById('postTags').value = Array.isArray(postData.hashtags)
			? postData.hashtags.join(', ')
			: (postData.hashtags || '');
  
		  // Status
		  if (postData.status === 'published') {
			document.getElementById('statusPublished').checked = true;
		  } else if (postData.status === 'draft') {
			document.getElementById('statusDraft').checked = true;
		  } else if (postData.status === 'scheduled') {
			document.getElementById('statusScheduled').checked = true;
			// Isi tanggal dan waktu jika ada
			if (postData.scheduledTimestamp) {
			  const dateObj = new Date(postData.scheduledTimestamp);
			  if (document.getElementById('scheduleDate')) document.getElementById('scheduleDate').value = dateObj.toISOString().slice(0,10);
			  if (document.getElementById('scheduleTime')) document.getElementById('scheduleTime').value = dateObj.toTimeString().slice(0,5);
			}
		  }
  
		  // Ubah judul form (opsional)
		  if (document.getElementById('formTitle')) {
			document.getElementById('formTitle').textContent = "Edit Postingan";
		  }
		}, 400);
	  } else {
		alert("Postingan tidak ditemukan.");
	  }
	});
  }
  window.editPost = editPost;
  

// New: Function to handle viewing a post
function viewPost(postSlug) {
	window.open(`https://bimaakbar.netlify.app/post.html?slug=${postSlug}`, '_blank');
}
window.viewPost = viewPost;


// --- Category Management Section (New Feature) ---
function initSettingsSection() {

	console.log('Menginisialisasi Pengaturan...');

	stopSectionListeners('settingsSection');



	const adminEmailInput = document.getElementById('adminEmail');

	const siteNameInput = document.getElementById('siteName');

	const itemsPerPageInput = document.getElementById('itemsPerPage');

	const settingsForm = document.getElementById('settingsForm');

	const settingsMessage = document.getElementById('settingsMessage');



	if (adminEmailInput && auth.currentUser) {

		adminEmailInput.value = auth.currentUser.email;

	}



	database.ref('BimaAkbar/settings').once('value').then(snapshot => { //
		const settings = snapshot.val();

		if (settings) {

			if (siteNameInput) siteNameInput.value = settings.siteName || '';

			if (itemsPerPageInput) itemsPerPageInput.value = settings.itemsPerPage || 10;

		}

	}).catch(error => console.error("Error loading settings:", error));



	if (settingsForm) {

		if (window.settingsFormSubmitHandler) {

			settingsForm.removeEventListener('submit', window.settingsFormSubmitHandler);

		}



		window.settingsFormSubmitHandler = (event) => {

			event.preventDefault();

			settingsMessage.textContent = 'Menyimpan pengaturan...';

			settingsMessage.style.color = '#8E8E93';



			const newSiteName = siteNameInput ? siteNameInput.value.trim() : '';

			const newItemsPerPage = itemsPerPageInput ? parseInt(itemsPerPageInput.value) : 10;



			database.ref('BimaAkbar/settings').update({ //
					siteName: newSiteName,

					itemsPerPage: newItemsPerPage,

					lastUpdated: firebase.database.ServerValue.TIMESTAMP

				})

				.then(() => {

					settingsMessage.textContent = 'Pengaturan berhasil disimpan!';

					settingsMessage.style.color = 'var(--primary-color)';

				})

				.catch(error => {

					settingsMessage.textContent = `Gagal menyimpan pengaturan: ${error.message}`;

					settingsMessage.style.color = 'red';

					console.error("Error saving settings:", error);

				});

		};

		settingsForm.addEventListener('submit', window.settingsFormSubmitHandler);

	}



	const changePasswordBtn = document.getElementById('changePasswordBtn');

	if (changePasswordBtn) {

		changePasswordBtn.onclick = () => {

			const newPassword = prompt("Masukkan password baru (minimal 6 karakter):");

			if (newPassword && newPassword.length >= 6) {

				auth.currentUser.updatePassword(newPassword)

					.then(() => {

						alert("Password berhasil diubah!");

						settingsMessage.textContent = 'Password berhasil diubah!';

						settingsMessage.style.color = 'var(--primary-color)';

					})

					.catch((error) => {

						alert(`Gagal mengubah password: ${error.message}`);

						settingsMessage.textContent = `Gagal mengubah password: ${error.message}`;

						settingsMessage.style.color = 'red';

						console.error("Error updating password:", error);

					});

			} else if (newPassword !== null) {

				alert("Password minimal 6 karakter.");

			}

		};

	}

}



// --- Navigation Link Event Listeners ---

navLinks.forEach(link => {

	link.addEventListener('click', (event) => {

		event.preventDefault();



		const targetId = link.getAttribute('data-target');

		if (targetId) {

			loadContent(targetId);

		}

	});

});



// Handle initial load based on URL parameter or default to dashboard

document.addEventListener('DOMContentLoaded', () => {

	const urlParams = new URLSearchParams(window.location.search);

	const initialPage = urlParams.get('page') || 'dashboard';

	const initialTargetId = `${initialPage}Section`;



	navLinks.forEach(item => item.classList.remove('active'));

	const initialLink = document.querySelector(`.nav-link[data-target="${initialTargetId}"]`);

	if (initialLink) {

		initialLink.classList.add('active');

	} else {

		document.querySelector('.nav-link[data-target="dashboardSection"]').classList.add('active');

	}

});



// To handle browser back/forward buttons

window.addEventListener('popstate', () => {

	const urlParams = new URLSearchParams(window.location.search);

	const page = urlParams.get('page') || 'dashboard';

	const targetId = `${page}Section`;

	loadContent(targetId);

});
    </script>
</body>
</html>
